<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>公出單</title>

    <link rel="stylesheet" href="/BPM_TaskPane/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/BPM_TaskPane/bootstrap/css/bootstrap-responsive.min.css">

    <link rel="stylesheet" href="/BPM_TaskPane/jquery-ui-1.11.4/jquery-ui.css">
    <link rel="stylesheet" href="/BPM_TaskPane/jquery-ui-1.11.4/themes/smoothness/jquery-ui.css">

    <link rel="stylesheet" href="/BPM_TaskPane/Content/site.css">
    <link rel="stylesheet" href="/BPM_TaskPane/Content/borg.dialog.css">

    <link rel="stylesheet" href="/BPM_TaskPane/Content/uploadfile.css">
    <link rel="stylesheet" href="/BPM_TaskPane/Content/summernote.css">

    <link rel="stylesheet" href="/BPM_TaskPane/Content/taskpanel.css">

    <style>
        .btn,
        .dropdown-menu {
            font-size: 16px;
        }

        .validation-summary-errors {
            color: red;
            font-size: 1.1em;
        }

        #PhraseModal .modal-dialog {
            width: 400px;
        }

        #SystemPhrases .glyphicon-ok {
            position: relative;
            top: -18px;
            float: right;
        }

        #MyPhrases .glyphicon-ok,
        #MyPhrases .glyphicon-remove,
        #MyPhrases .glyphicon-floppy-disk {
            position: relative;
            top: 5px;
            float: right;
        }

        .ellipsis {
            width: 280px;
        }

        .ajax-file-upload-container {
            display: none;
        }

        #SelectCcModal .modal-dialog {
            width: 550px;
        }

        #SelectCcModal .glyphicon-plus,
        #SelectCcModal .glyphicon-search,
        #SelectChangeHandlerModal .glyphicon-plus,
        #SelectChangeHandlerModal .glyphicon-search {
            position: relative;
            top: -1px;
        }

        #SelectCcModal .btnCcSearch {
            width: 45px;
            height: 32px;
        }

        #SelectCcModal .list-group-item .btn,
        #SelectChangeHandlerModal .list-group-item .btn {
            float: right;
            width: 45px;
            height: 32px;
            position: relative;
            top: -4px;
        }

        #SelectChangeStepModal .modal-dialog {
            width: 400px;
        }

        #SelectChangeStepModal .glyphicon-ok {
            position: relative;
        }
    </style>

    <style>
        /*--- table and Grid --- */
        table[id*='MyGrid'] tr > th,
        .fdTable tr > th {
            background: #f5f5f5;
        }

        /*--- Grid --- */
        table[id*='MyGrid'] tr > td:first-child {
            min-width: 100px;
        }

        table[id*='MyGrid'] tr > th:first-child {
            /*display: block !important;*/
            text-align: left !important;
        }

        table[id*='MyGrid'] input.btn {
            background: #fff;
            border: 1px solid #ccc;
            font-weight: bold;
            color: #555;
        }

            table[id*='MyGrid'] input.btn:hover,
            table[id*='MyGrid'] input.btn.btn-primary:active,
            table[id*='MyGrid'] input.btn.btn-primary:focus {
                border: 1px solid #aaa;
                background: #eee;
            }
            /*new*/
            table[id*='MyGrid'] input.btn.btn-primary.grid-create {
                color: #4CAF50;
            }
            /*edit save*/
            table[id*='MyGrid'] input.btn.btn-primary.grid-edit,
            table[id*='MyGrid'] input.btn.btn-primary.grid-view,
            table[id*='MyGrid'] input.btn.btn-primary.grid-save {
                color: rgb(61, 140, 204);
                margin: 0 3px 0 0;
            }
            /*delete cancel*/
            table[id*='MyGrid'] input.btn.btn-danger.grid-delete,
            table[id*='MyGrid'] input.btn.btn-warning.grid-cancel {
                color: #e86e65;
            }
    </style>

    <style>
        a > .form-control {
            width: 90% !important;
        }

        a > img {
            width: 25px;
            height: 25px;
        }
    </style>

    <style>
        .summerStyle {
            border: 1px solid #aaa;
            background: #fafafa;
            padding: 10px;
            max-height: 500px;
            overflow-y: auto;
        }
    </style>

<style id="templateCss">
        body {
    font-family: "微軟正黑體";
    font-size: 17px;
    background: #e5e5e5;
    color: #000000;
    background-size: cover;
}

blockquote {
    border-left: 0px solid #eee;
}

    blockquote small {
        color: #000;
    }

.table-bordered {
    border: 1px solid #348cce;
    margin: 0;
}

tr {
    color: #000;
    border-radius: 3px;
}

table[id*='MyGrid'] tr > th, .fdTable tr > th {
    font-size: 15px;
    font-weight: bold !important;
    text-align: center;
    padding: 10px;
    background: rgba(52,140,206,0.7);
    color: #fff;
    border: 1px solid #348cce;
}

div[id*=MyGrid][role='dialog'] .modal-header {
    background: rgba(155,155,155,1);
    border-radius: 6px 6px 0 0;
    box-shadow: 0px 3px 7px -2px #999;
    color: #FFF;
}

    div[id*=MyGrid][role='dialog'] .modal-header .close {
        opacity: 1;
        color: #fff;
        text-shadow: none;
    }

div[id*=MyGrid][role='dialog'] .modal-body {
    background: #eee;
}

div[id*=MyGrid][role='dialog'] td[data-th="title"] {
    vertical-align: top;
    line-height: 2.2;
    font-weight: bold;
}

#form1 .row table .form-control {
    background: #fff;
    border: 1px solid #348cce;
}

#form1 .row thead>tr>td {
    background: rgba(255,255,255,1);
    border: 1px solid #348cce !important;
    font-size: 16px;
    font-weight: bold;
    text-align: center;
    color: #636363;
    padding: 4px 7px 4px 6px !important;
}

#form1 .row table:nth-last-child(1) td {
    border: 0 !important;
    font-weight: normal !important;
    color: #000;
}


.form-group {
    margin-bottom: 0px;
}

.readOnly {
    background: #adccdb !important;
    color: #555 !important;
}

.container {
    box-shadow: 1px 1px 7px 0px rgba(0,0,0,0.4);
    margin-top: 20px;
    padding: 20px 10px;
    background: #fff;
}

.row {
    padding: 5px 0 13px;
    margin: 0;
}

    .row legend {
        top: -27px;
        position: relative;
        left: 20px;
        width: auto;
        border-radius: 5px;
        background: #c1def7;
        padding: 1px 10px 3px;
        margin: 15px 100px -15px 15px;
    }

label.form-sub-label {
    font-size: 0.9em;
    color: #666;
    font-weight: normal;
    margin-left: 25px;
}

h1 {
    text-align: center;
    background: #348cce;
    padding: 10px 40px 15px;
    border-radius: 5px;
    font-size: 1.8em;
    font-weight: bold !important;
    color: #fff;
}

label {
    vertical-align: top;
    font-weight: inherit;
    margin: 10px 5px 2px;
}

.form-control {
    height: auto;
    font-size: inherit;
    font-weight: inherit;
    font-style: inherit;
    font-family: inherit;
    color: inherit;
    width: 100% !important;
    max-width: 100%;
}

.form-group > label {
    font-weight: bold;
    padding-right: 20px;
    margin-top: 3px;
    display: block;
}

.tab-content > .active {
    border: 1px solid #ddd;
    border-width: 0 1px 1px;
}

input[type=checkbox], input[type=radio] {
    margin: 0 4px 0 13px;
}

.checkboxItems, .radioItems {
    box-shadow: none;
    border: none;
}

textarea.form-control {
    height: 200px;
}

.rowWithLengend {
    border: 1px solid #c1def7;
    margin: 30px 15px 20px 15px;
}

.panel-title a {
    background: #55b6ff;
    color: #464646;
}

    .panel-title a:hover {
        background: #acddfc;
        color: #464646;
    }

#sign1 .col-md-12 {
    background: #dedee0;
}

#sign .btn.disabled,
#sign .btn[disabled],
#sign fieldset[disabled] .btn {
    background: none;
}

#sign .bg-gray {
    background: linear-gradient(to top, rgba(240,240,240,1) 0%,rgba(251,251,251,1) 100%);
}

    #sign .bg-gray:hover {
        background: #d2e6f7;
        color: #464646;
    }

.form-control::-webkit-input-placeholder {
    color: #9b9b9b;
}

.form-control:-moz-placeholder {
    color: #9b9b9b;
}

.form-control::-moz-placeholder {
    color: #9b9b9b;
}

.form-control:-ms-input-placeholder {
    color: #9b9b9b;
}


.rwd-table th, .rwd-table td {
    padding: 4px 15px 4px 6px !important;
    vertical-align: middle !important;
}

</style>


<style>

    #_92663>legend { display:none; }
#_611995>legend { display:none; }
#_144934>legend { display:none; }
#_833410>legend { display:none; }
#_739485 { font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; }
#_739485 th { font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; }
#_739485>legend { font-weight:inherit;font-style:inherit;display:inline-block; }

    #_262468 { font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; }
#_262468 input { font-weight:inherit;font-style:inherit; }
#_518401 { font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; }
#_518401 input { font-weight:inherit;font-style:inherit; }
#_459447 { font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; }
#_459447 input { font-weight:inherit;font-style:inherit; }
#_245933 h1 { font-weight:bold;font-style:inherit;font-family:微軟正黑體;font-size:24px; }
#_138286 { font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; }
#_138286 input { font-weight:inherit;font-style:inherit; }
#_912379 { font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; }
#_912379 textarea { height:70px; }
#_841069 { font-weight:inherit;font-style:inherit;font-size:inherit; }
#_954799 { font-weight:inherit;font-style:inherit;font-size:inherit; }
#_950173 .divHTML { font-weight:bold;font-style:inherit;font-family:微軟正黑體;font-size:inherit; }
#_308865 .divHTML { font-weight:bold;font-style:inherit;font-family:微軟正黑體;font-size:inherit; }
#_778236 { font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; }
#_431127 { font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; }
#_431127 input { font-weight:inherit;font-style:inherit; }
#_725612 { font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; }
#_725612 input { font-weight:inherit;font-style:inherit; }
#_488388 { font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; }
#_488388 input { font-weight:inherit;font-style:inherit; }

</style>

</head>
<body class="bodyStyle">
    <div class="container" id="body">







<form action="/FormDesigner/TaskPane/FormUse" id="form1" method="post"><div class="row" id="_92663"><legend></legend><div><div class="col-md-12 colStyle"><div id="_245933"><h1 id="heading001">公出單</h1></div></div></div></div><div class="row" id="_611995"><legend></legend><div><div class="col-md-4 colStyle"><div class="form-group form-inline" id="_262468"><label for="textBox003">申請人部門：</label><input class="form-control" type="text" id="textBox003" name="textBox003" placeholder="" value="" /></div><div class="form-group form-inline" id="_725612"><label for="textBox001">起點：</label><input class="form-control" type="text" id="textBox001" name="textBox001" placeholder="" value="" /></div></div><div class="col-md-4 colStyle"><div class="form-group form-inline" id="_518401"><label for="textBox009">職稱：</label><input class="form-control" type="text" id="textBox009" name="textBox009" placeholder="" value="" /></div><div class="form-group form-inline" id="_488388"><label for="textBox002">終點：</label><input class="form-control" type="text" id="textBox002" name="textBox002" placeholder="" value="" /></div></div><div class="col-md-4 colStyle"><div class="form-group form-inline" id="_459447"><label for="textBox010">申請人：</label><input class="form-control" type="text" id="textBox010" name="textBox010" placeholder="" value="" /></div><div class="form-group form-inline" id="_778236"><label for="dropDownList001">交通工具：</label><select class="form-control optionItems" id="dropDownList001" name="dropDownList001" title="交通工具：" rel-source="_778236" rel-params=""><option value=''></option><option value='1'>計程車</option><option value='2'>火車</option><option value='3'>飛機</option><option value='4'>高鐵</option><option value='5'>巴士</option><option value='6'>其他</option></select></div></div></div></div><div class="row" id="_144934"><legend></legend><div><div class="col-md-3 colStyle"><div class="form-group form-inline" id="_841069"><label for="calendar001">起始日期：</label><input class="datepicker form-control" type="text" id="calendar001" name="calendar001" placeholder="系統目前日期" value="" defaultDate="true" /></div></div><div class="col-md-3 colStyle"><div class="form-group form-inline" id="_950173"><div class="divHTML" id="divHTML001">開 始 時 間：<br><select class="form-control" id="SHour" style="width: 70px !important;" runat="server"><option value="1">00</option><option value="2">01</option><option value="3">02</option><option value="4">03</option><option value="5">04</option><option value="6">05</option><option value="7">06</option><option value="8">07</option><option value="9">08</option><option value="10" selected="">09</option><option value="11">10</option><option value="12">11</option><option value="13">12</option><option value="14">13</option><option value="15">14</option><option value="16">15</option><option value="17">16</option><option value="18">17</option><option value="19">18</option><option value="20">19</option><option value="21">20</option><option value="22">21</option><option value="23">22</option><option value="24">23</option></select><select class="form-group form-inline form-control" id="SMin" style="width: 70px !important;" runat="server"><option value="1" selected="">00</option><option value="2">10</option><option value="3">20</option><option value="4">30</option><option value="5">40</option><option value="6">50</option></select></div></div></div><div class="col-md-3 colStyle"><div class="form-group form-inline" id="_954799"><label for="calendar002">迄止日期：</label><input class="datepicker form-control" type="text" id="calendar002" name="calendar002" placeholder="系統目前日期" value="" defaultDate="true" /></div></div><div class="col-md-3 colStyle"><div class="form-group form-inline" id="_308865"><div class="divHTML" id="divHTML002">結 束 時 間：<br><select class="form-control" id="EHour" style="width: 70px !important;" runat="server"><option value="1">00</option><option value="2">01</option><option value="3">02</option><option value="4">03</option><option value="5">04</option><option value="6">05</option><option value="7">06</option><option value="8">07</option><option value="9">08</option><option value="10">09</option><option value="11">10</option><option value="12">11</option><option value="13">12</option><option value="14">13</option><option value="15">14</option><option value="16">15</option><option value="17">16</option><option value="18">17</option><option selected="19" value="">18</option><option value="20">19</option><option value="21">20</option><option value="22">21</option><option value="23">22</option><option value="24">23</option></select><select class="form-control" id="EMin" style="width: 70px !important;" runat="server"><option value="1" selected="">00</option><option value="2">10</option><option value="3">20</option><option value="4">30</option><option value="5">40</option><option value="6">50</option></select></div></div><div class="form-group form-inline" id="_431127"><label for="Hour">合計(時)：</label><input class="form-control" type="text" id="Hour" name="Hour" placeholder="僅限數字" value="8" /></div></div></div></div><div class="row" id="_833410"><legend></legend><div><div class="col-md-6 colStyle"><div class="form-group form-inline" id="_912379"><label for="textArea001">公差事由：</label><textarea class="form-control" id="textArea001" name="textArea001" placeholder=""></textarea></div></div><div class="col-md-6 colStyle"><div class="form-group form-inline" id="_138286"><label for="textBox005">合計費用：</label><input class="form-control" type="text" id="textBox005" name="textBox005" placeholder="" value="" /></div></div></div></div><div class="row" id="_739485"><legend>預估旅費</legend><div class="col-md-12 grid_739485"><b>Grid Loading....</b></div></div></form>



<form action="/FormDesigner/TaskPane/FormUse" id="taskpane" method="post"><div class="validation-summary-valid" data-valmsg-summary="true"><ul><li style="display:none"></li>
</ul></div>            <div class="taskpane" style="display: none;">
                <table>
                    <tr>
                        <td span="5">reference FormUse.aspx.cs</td>
                    </tr>
                    <tr>
                        <td>m.logon:<br /><input id="logon" name="logon" data-val="true" type="text" value="xaEj FIBdFI~eq~" /></td>
                        <td>m.login:<br /><input id="login" name="login" data-val="true" type="text" value="0007" /></td>
                        <td>m.SPM_CaseId:<br /><input id="SPM_CaseId" name="SPM_CaseId" data-val="true" type="text" value="54503" /></td>
                        <td>m.SPM_TaskId:<br /><input id="SPM_TaskId" name="SPM_TaskId" data-val="true" type="text" value="45681" /></td>
                        <td>m.SPM_FormSn:<br /><input id="SPM_FormSn" name="SPM_FormSn" data-val="true" type="text" value="79" /></td>
                    </tr>
                    <tr>
                        <td>m.SPM_PlanSn:<br /><input id="SPM_PlanSn" name="SPM_PlanSn" data-val="true" type="text" value="125" /></td>
                        <td>m.SPM_PlanName:<br /><input id="SPM_PlanName" name="SPM_PlanName" data-val="true" type="text" value="公出單" /></td>
                        <td>m.SPM_StepSn:<br /><input id="SPM_StepSn" name="SPM_StepSn" data-val="true" type="text" value="924" /></td>
                        <td>m.SPM_StepName:<br /><input id="SPM_StepName" name="SPM_StepName" data-val="true" type="text" value="主管審核" /></td>
                        <td>m.SPM_HandleType:<br /><input id="SPM_HandleType" name="SPM_HandleType" data-val="true" type="text" value="2" /></td>
                    </tr>
                    <tr>
                        <td>m.SPM_Status:<br /><input id="SPM_Status" name="SPM_Status" data-val="true" type="text" value="" /></td>
                        <td>m.Backupid:<br /><input id="Backupid" name="Backupid" data-val="true" type="text" /></td>
                        <td>m.OpenFrom:<br /><input id="OpenFrom" name="OpenFrom" data-val="true" type="text" value="" /></td>
                    </tr>
                    <tr>
                        <td span="5">reference TaskPane001.aspx.cs</td>
                    </tr>
                    <tr>
                        <td>m.SPM_Multi:<br /><input id="SPM_Multi" name="SPM_Multi" data-val="true" type="text" value="" /></td>
                        <td>m.SPM_Uid:<br /><input id="SPM_Uid" name="SPM_Uid" data-val="true" type="text" value="0007" /></td>
                        <td>m.SPM_SigleTaskId:<br /><input id="SPM_SigleTaskId" name="SPM_SigleTaskId" data-val="true" type="text" value="" /></td>
                        <td>m.CASEID1:<br /><input id="CASEID1" name="CASEID1" data-val="true" type="text" value="" /></td>
                        <td>m.TASKID1:<br /><input id="TASKID1" name="TASKID1" data-val="true" type="text" value="" /></td>
                    </tr>
                    <tr>
                        <td>m.HANDLERID:<br /><input id="HANDLERID" name="HANDLERID" data-val="true" type="text" value="17" /></td>
                        <td>m.SPM_HandleStatus:<br /><input id="SPM_HandleStatus" name="SPM_HandleStatus" data-val="true" type="text" value="" /></td>
                        <td>m.SPM_Data:<br /><textarea id="SPM_Data" name="SPM_Data" rows="2" cols="80" data-val="true">&lt;EFormData&gt;&lt;BPM_FieldData&gt;&lt;CALENDAR001&gt;2018/12/12&lt;/CALENDAR001&gt;&lt;DROPDOWNLIST001&gt;1&lt;/DROPDOWNLIST001&gt;&lt;TEXTBOX010&gt;林煜亘&lt;/TEXTBOX010&gt;&lt;__XMLMYGRID1&gt;&lt;/__XMLMYGRID1&gt;&lt;CALENDAR002&gt;2018/12/12&lt;/CALENDAR002&gt;&lt;__JSNMYGRID1&gt;[]&lt;/__JSNMYGRID1&gt;&lt;__MYGRID1_BTNADDNEW&gt;新增&lt;/__MYGRID1_BTNADDNEW&gt;&lt;TEXTBOX003&gt;資訊組&lt;/TEXTBOX003&gt;&lt;__TBLMYGRID1&gt;[{&quot;TableName&quot;:&quot;WF_P_BT_Grid1&quot;}]&lt;/__TBLMYGRID1&gt;&lt;TEXTBOX009&gt;專員(01)&lt;/TEXTBOX009&gt;&lt;TEXTBOX001&gt;起起起起起起起起起起起起起起起起起起起起終終終終終開&lt;/TEXTBOX001&gt;&lt;SMIN&gt;1&lt;/SMIN&gt;&lt;HOUR&gt;8&lt;/HOUR&gt;&lt;EMIN&gt;1&lt;/EMIN&gt;&lt;EHOUR&gt;&lt;/EHOUR&gt;&lt;__OLDKEYIDMYGRID1&gt;&lt;/__OLDKEYIDMYGRID1&gt;&lt;TEXTBOX005&gt;0&lt;/TEXTBOX005&gt;&lt;SHOUR&gt;10&lt;/SHOUR&gt;&lt;TEXTBOX002&gt;&lt;/TEXTBOX002&gt;&lt;TEXTAREA001&gt;開１１１１１１１１１１１&lt;/TEXTAREA001&gt;&lt;/BPM_FieldData&gt;&lt;/EFormData&gt;</textarea></td>
                        <td>m.SPM_txtCC:<br /><input id="SPM_txtCC" name="SPM_txtCC" data-val="true" type="text" value="" /></td>
                        <td>m.SPM_Level:<br /><input id="SPM_Level" name="SPM_Level" data-val="true" type="text" value="" /></td>
                    </tr>
                    <tr>
                        <td>m.SPM_Action:<br /><input id="SPM_Action" name="SPM_Action" data-val="true" type="text" value="" /></td>
                        <td>m.SPM_TaskPaneUrl:<br /><input id="SPM_TaskPaneUrl" name="SPM_TaskPaneUrl" data-val="true" type="text" value="" /></td>
                        <td>m.SPM_DownloadMode:<br /><input id="SPM_DownloadMode" name="SPM_DownloadMode" data-val="true" type="text" value="Browser" /></td>
                        <td>m.txtCC:<br /><input id="txtCC" name="txtCC" data-val="true" type="text" value="" /></td>
                        <td>m.txtRecever:<br /><input id="txtRecever" name="txtRecever" data-val="true" type="text" value="HR(蔡信志(0004))" /></td>
                    </tr>
                    <tr>
                        <td>m.ReceiptList:<br /><input id="ReceiptList" name="ReceiptList" data-val="true" type="text" value="925(14);HR(蔡信志(0004))" /></td>
                        <td>m.txtSUBJECT:<br /><input id="txtSUBJECT" name="txtSUBJECT" data-val="true" type="text" value="" /></td>
                        <td>m.txtOPINION:<br /><textarea id="txtOPINION" name="txtOPINION" rows="2" cols="80" data-val="true"></textarea></td>
                        <td>m.txtMemo:<br /><textarea id="txtMemo" name="txtMemo" rows="2" cols="80" data-val="true"></textarea></td>
                        <td>m.txtUpload:<br /><textarea id="txtUpload" name="txtUpload" rows="2" cols="80" data-val="true"></textarea></td>
                    </tr>
                    <tr>
                        <td>m.url:<br /><input id="url" name="url" data-val="true" type="text" value="PlanSn=125&amp;CaseId=54503&amp;Options=8;103;" /></td>
                        <td>m.Mode:<br /><input id="Mode" name="Mode" data-val="true" type="text" value="" /></td>
                        <td>m.CurrentStepSn:<br /><input id="CurrentStepSn" name="CurrentStepSn" data-val="true" type="text" value="924" /></td>
                        <td>m.SendCaption:<br /><input id="SendCaption" name="SendCaption" data-val="true" type="text" value="傳送" /></td>
                        <td>m.RejectCaption:<br /><input id="RejectCaption" name="RejectCaption" data-val="true" type="text" value="退簽" /></td>
                    </tr>
                    <tr>
                        <td>m.FormGUID:<br /><input id="FormGUID" name="FormGUID" data-val="true" type="text" value="d91c39cb-1da2-44bf-889b-1995180c039a" /></td>
                        <td>m.blAttachFile:<br /><input id="blAttachFile" name="blAttachFile" data-val="true" type="text" value="value" /></td>
                        <td>m.IsFormReg:<br /><input id="IsFormReg" name="IsFormReg" data-val="true" type="text" value="True" /></td>
                        <td>m.IsLoadData:<br /><input id="IsLoadData" name="IsLoadData" data-val="true" type="text" value="True" /></td>
                        <td>m.IsReadOnly:<br /><input id="IsReadOnly" name="IsReadOnly" data-val="true" type="text" value="True" /></td>
                    </tr>
                    <tr>
                        <td>m.IsPostBack:<br /><input id="IsPostBack" name="IsPostBack" data-val="true" type="text" value="False" /></td>
                        <td>m.IsBackEnd:<br /><input id="IsBackEnd" name="IsBackEnd" data-val="true" type="text" value="N" /></td>
                        <td>m.IsReturnAll:<br /><input id="IsReturnAll" name="IsReturnAll" data-val="true" type="text" value="None" /></td>
                        <td>m.OLD_XMLDATA:<br /><textarea id="OLD_XMLDATA" name="OLD_XMLDATA" rows="2" cols="80" data-val="true"></textarea></td>
                        <td>m.jsViewState:<br /><textarea id="jsViewState" name="jsViewState" rows="2" cols="80" data-val="true">332ad7b5-193a-4fae-95b6-43bfd041be79</textarea></td>
                    </tr>
                    <tr>
                        <td>m.strDataType:<br /><input id="strDataType" name="strDataType" data-val="true" type="text" value=";;calendar001=0;calendar002=0;dropDownList001=0;EHour=0;EMin=0;Hour=1;MyGrid1=0;SHour=0;SMin=0;textArea001=0;textBox001=0;textBox002=0;textBox003=0;textBox005=1;textBox009=0;textBox010=0;" /></td>
                        <td>m.strHide:<br /><input id="strHide" name="strHide" data-val="true" type="text" value=";;" /></td>
                        <td>m.strEdit:<br /><input id="strEdit" name="strEdit" data-val="true" type="text" value=";;" /></td>
                        <td>m.strEmpty:<br /><input id="strEmpty" name="strEmpty" data-val="true" type="text" value=";;calendar001;calendar002;dropDownList001;EHour;EMin;Hour;MyGrid1;SHour;SMin;textArea001;textBox001;textBox002;textBox003;textBox005;textBox009;textBox010;" /></td>
                        <td>m.strCaption:<br /><input id="strCaption" name="strCaption" data-val="true" type="text" value="calendar001=起始日期：;calendar002=迄止日期：;dropDownList001=交通工具：;EHour=EHour;EMin=EMin;Hour=合計(時)：;MyGrid1=MyGrid1;SHour=SHour;SMin=SMin;textArea001=公差事由：;textBox001=起點：;textBox002=終點：;textBox003=申請人部門：;textBox005=合計費用：;textBox009=職稱：;textBox010=申請人：;" /></td>
                    </tr>
                    <tr>
                        <td>m.blBackCase:<br /><input id="blBackCase" name="blBackCase" data-val="true" type="text" value="False" /></td>
                        <td>m.blCC:<br /><input id="blCC" name="blCC" data-val="true" type="text" value="False" /></td>
                        <td>m.bIsRecall:<br /><input id="bIsRecall" name="bIsRecall" data-val="true" type="text" value="False" /></td>
                        <td>m.bIsBackout:<br /><input id="bIsBackout" name="bIsBackout" data-val="true" type="text" value="False" /></td>
                        <td>m.CanChangeStep:<br /><input id="CanChangeStep" name="CanChangeStep" data-val="true" type="text" value="False" /></td>
                    </tr>
                    <tr>
                        <td>m.RangeChangeStep:<br /><input id="RangeChangeStep" name="RangeChangeStep" data-val="true" type="text" value="" /></td>
                        <td>m.CanAssignHandler:<br /><input id="CanAssignHandler" name="CanAssignHandler" data-val="true" type="text" value="False" /></td>
                        <td>m.CanConferHandler:<br /><input id="CanConferHandler" name="CanConferHandler" data-val="true" type="text" value="False" /></td>
                        <td>m.CanReassignHandler:<br /><input id="CanReassignHandler" name="CanReassignHandler" data-val="true" type="text" value="False" /></td>
                        <td>m.CanMoveHandler:<br /><input id="CanMoveHandler" name="CanMoveHandler" data-val="true" type="text" value="False" /></td>
                    </tr>
                </table>
            </div>
</form>        <div class="ajaxUploadFile hidden" rel-target=".UploadFileList">選擇檔案</div>
        <input class="UploadFileList hidden" type="text" />
        <div class="panel panel-default" style="display: ;">
            <div class="panel-heading" role="tab" id="headingOne">
                <h4 class="panel-title">
                    <a aria-expanded="true" data-toggle="collapse" href="#sign" aria-controls="sign">
                        <span class="glyphicon glyphicon-chevron-down"></span> 簽核
                    </a>
                </h4>
            </div>
            <div id="sign" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne" aria-expanded="true">
                <div class="panel-body">
                    <div class="row-fluid" id="sign1">
                        <div class="col-md-12">
                            <button type="button" class="btn btn-default btnSend" title="傳送" style="">
                                <span class="glyphicon glyphicon-ok"></span> <span class="hidden-phone">傳送</span>
                            </button>
                            <button type="button" class="btn btn-default btnReturn" title="退簽" style="display: none;">
                                <span class="glyphicon glyphicon-remove"></span> <span class="hidden-phone">退簽</span>
                            </button>
                            <button type="button" class="btn btn-default btnSave" title="儲存" style="">
                                <span class="glyphicon glyphicon-floppy-disk"></span> <span class="hidden-phone">儲存</span>
                            </button>
                            <button type="button" class="btn btn-default btnFlowChart" title="流程圖">
                                <span class="glyphicon glyphicon-random"></span> <span class="hidden-phone">流程圖</span>
                            </button>
                            <button type="button" class="btn btn-default btnPrint" title="列印">
                                <span class="glyphicon glyphicon-print"></span> <span class="hidden-phone">列印</span>
                            </button>
                            <button type="button" class="btn btn-default btnRecall" title="抽單" style="display: none;">
                                <span class="glyphicon glyphicon-share-alt"></span> <span class="hidden-phone">抽單</span>
                            </button>
                            <button type="button" class="btn btn-default btnBackout" title="撤銷" style="display: none;">
                                <span class="glyphicon glyphicon-ban-circle"></span> <span class="hidden-phone">撤銷</span>
                            </button>
                            <div class="btn-group">
                                <button type="button" class="btn btn-default btnipHigh" title="重要性高" style="color: red;" rel-value="High">
                                    <span class="glyphicon glyphicon-exclamation-sign"></span>
                                </button>
                                <button type="button" class="btn btn-default btnipLow" title="重要性低" style="color: blue;" rel-value="Low">
                                    <span class="glyphicon glyphicon-arrow-down"></span>
                                </button>
                            </div>
                            <div class="btn-group" style="display: none;">
                                <button type="button" class="btn btn-default btnPrevious" title="Previous">
                                    <span class="glyphicon glyphicon-triangle-left"></span>
                                </button>
                                <button type="button" class="btn btn-default btnNext" title="Next">
                                    <span class="glyphicon glyphicon-triangle-right"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid" id="sign2">
                        <div class="form-horizontal form-group-sm">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <div class="input-group-btn">
                                        <button type="button" class="btn bg-gray btn-sm dropdown-toggle disabled" data-toggle="dropdown">
                                            收件者
                                            <span class="caret" style="display: none;"></span>
                                        </button>
                                        <ul class="dropdown-menu" role="menu">
                                            <li rel-value="defaultNextTo"><a>預設下一關</a></li>
                                            <li rel-value="changeStep" style="display: none;"><a>改變關卡</a></li>
                                            <li rel-value="confer" style="display: none;"><a>加會</a></li>
                                            <li rel-value="reassign" style="display: none;"><a>移辦</a></li>
                                            <li rel-value="move" style="display: none;"><a>改分</a></li>
                                        </ul>
                                    </div>
                                    <input type="text" class="form-control table txtRecever" id="txtRecever" readonly="readonly" rel-nextto="defaultNextTo" />
                                    <div class="input-group-btn" style="display: none;">
                                        <button type="button" class="btn btn-sm bg-gray btn-dropdown btnNextTo"><span class="glyphicon glyphicon-comment"></span></button>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <div class="input-group-btn">
                                        <button type="button" class="btn bg-gray btn-sm" disabled="disabled">副本</button>
                                    </div>
                                    <input type="text" class="form-control table txtCC" id="txtCC" readonly="readonly" />
                                    <div class="input-group-btn" style="display: none;">
                                        <button type="button" class="btn btn-sm bg-gray btn-dropdown btnCc"><span class="glyphicon glyphicon-comment"></span></button>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <span class="input-group-btn">
                                        <button class="btn bg-gray btn-sm" type="button" disabled="disabled">主旨</button>
                                    </span>
                                    <input type="text" class="form-control table txtSUBJECT"  />
                                </div>
                                <div class="input-group">
                                    <div class="input-group-btn">
                                        <button class="btn bg-gray btn-sm attachment btnUploadAttach" type="button">附件</button>
                                    </div>
                                    <div type="text" class="form-control table attachment readOnly lblAttachList" id="divUpload">
                                        Loading...
                                    </div>
                                    <input type="text" class="form-control table txtUpload" style="display: none;" />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-btn">
                                        <button class="btn bg-gray btn-sm btnOpinions " type="button" style="height: 65px;">意見</button>
                                    </span>
                                    <textarea type="text" class="form-control table txtOPINION" rows="3" ></textarea>
                                </div>
                                <div class="input-group">
                                    <span class="input-group-btn">
                                        <button class="btn bg-gray btn-sm btnMemos " type="button" style="height: 65px;">批註</button>
                                    </span>
                                    <textarea type="text" class="form-control table txtMemo" rows="3" ></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel panel-default" style="display: ;">
            <div class="panel-heading" role="tab" id="headingTwo">
                <h4 class="panel-title">
                    <a data-toggle="collapse" href="#record" aria-controls="record">
                        <span class="glyphicon glyphicon-chevron-right"></span> 流程簽核紀錄
                    </a>
                </h4>
            </div>
            <div id="record" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover table-condensed">
                                    <thead>
                                        <tr>
                                            <th>關卡</th>
                                            <th>處理時間</th>
                                            <th>用戶端主機</th>
                                            <th>處理者</th>
                                            <th>收件者</th>
                                            <th>意見</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                            <tr>
                                                <td><nobr>開始</nobr></td>
                                                <td><nobr>2018/12/12 10:12:58</nobr></td>
                                                <td><nobr>&nbsp;&nbsp;</nobr></td>
                                                <td><nobr>林煜亘</nobr></td>
                                                <td><nobr>林煜亘</nobr></td>
                                                <td><font color=red></font>申請.</td>
                                            </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <iframe id="ifrm_Attachment" src="" style="display: none;"></iframe>
    </div>

    <!--挑選簽核片語對話框-->
    <div class="modal fade" id="PhraseModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">挑選簽核片語</h4>
                </div>
                <div class="modal-body">
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="active" onclick="javascript: TabPage('1');"><a href="#SystemPhrases" role="tab" data-toggle="tab">系統簽核片語</a></li>
                        <li role="presentation" onclick="javascript: TabPage('2');"><a href="#MyPhrases" role="tab" data-toggle="tab">個人簽核片語</a></li>
                    </ul>

                    <!-- Tab panes -->
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="SystemPhrases">
                            <div class="panel panel-default">
                                <ul class="list-group" id="SystemPhrases_result"></ul>
                                <div class="panel-footer">
                                    <ul class="pagination" id="SysOpinions_pager"><li style="cursor: pointer;"><a aria-label="Previous"><span class="glyphicon glyphicon-backward" aria-hidden="true"></span></a></li><li class="active" style="cursor: pointer;"><a>1</a></li><li style="cursor: pointer;"><a>2</a></li><li style="cursor: pointer;"><a>3</a></li><li style="cursor: pointer;"><a>4</a></li><li style="cursor: pointer;"><a>5</a></li><li style="cursor: pointer;"><a aria-label="Next"><span class="glyphicon glyphicon-forward" aria-hidden="true"></span></a></li></ul>
                                </div>
                            </div>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="MyPhrases">
                            <div class="panel panel-default">
                                <ul class="list-group" id="MyPhrases_result"></ul>
                                <div class="panel-footer">
                                    <ul class="pagination" id="MyPhrases_pager"><li style="cursor: pointer;"><a aria-label="Previous"><span class="glyphicon glyphicon-backward" aria-hidden="true"></span></a></li><li class="active" style="cursor: pointer;"><a>1</a></li><li style="cursor: pointer;"><a>2</a></li><li style="cursor: pointer;"><a>3</a></li><li style="cursor: pointer;"><a>4</a></li><li style="cursor: pointer;"><a>5</a></li><li style="cursor: pointer;"><a aria-label="Next"><span class="glyphicon glyphicon-forward" aria-hidden="true"></span></a></li></ul>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default modalCancel" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-info modalOK" data-dismiss="modal">確定</button>
                </div>
            </div>
        </div>
    </div>

    <!--附件檔案上傳對話框-->
    <div class="modal fade" id="UploadAttachModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">附件檔案上傳</h4>
                </div>
                <div class="modal-body">
                    <div class="row-fluid" style="display: ">
                        <div>
                            <div>
                                <span><input id="rdoUploadFile" name="UploadMode" type="radio" checked="checked" />上傳檔案</span>
                                <div class="uploadAttach" rel-target=".BgImg" style="display: inline-block;" onclick="javascript: document.getElementById('rdoUploadFile').checked=true;">選擇檔案</div>
                            </div>
                        </div>
                        <div>
                            <div style="margin-top: 10px">
                                <span><input id="rdoLinkFile" name="UploadMode" type="radio" />連接檔案</span>
                                <div style="display: inline-block;">
                                    <input class="form-control txtLinkFilename" type="text" size="40" style="display: inline-block; width: auto!important" onfocus="javascript: getElementById('rdoLinkFile').checked=true;" />
                                    <input type="button" class="form-control btn-primary btnAddLinkFile" style="background: #4169e1; color: #fff; font-size: 16px; display: inline-block; width: auto!important" value="新增" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <table style="margin-top: 10px" class="table table-striped table-hover table-condensed lstAttachment">
                        <thead>
                            <tr>
                                <th>&nbsp;刪&nbsp;</th>
                                <th>檔案名稱</th>
                                <th>檔案大小</th>
                                <th>上傳者</th>
                                <th>上傳日期</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td colspan="5">Loading....</td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-info modalClose" data-dismiss="modal" style="width: 65px; font-size: 16px">關閉</button>
                    <input class="txtUpload2" type="text" style="display: none" />
                </div>
            </div>
        </div>
    </div>

    <!--挑選副本人員對話框-->
    <div class="modal fade" id="SelectCcModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">副本人員</h4>
                </div>
                <div class="modal-body">
                    <div class="row-fluid">
                        <div class="col-lg-12">
                            已選取範圍:<br />
                            <div type="text" class="form-control table Cc readOnly lblCcList" id="divCc">
                                Loading...
                            </div>
                            <input type="text" class="form-control SPM_txtCC" style="display: none;" />
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="col-lg-12">
                            挑選範圍:
                        </div><!-- /.col-lg-6 -->
                    </div><!-- /.row -->
                    <div class="row-fluid">
                        <div class="col-lg-12">
                            <table style="width: 100%">
                                <tr>
                                    <td>
                                        <div class="input-group">
                                            <div class="input-group-btn">
                                                <button type="button" class="btn btn-default dropdown-toggle" style="width: 100%; text-align: left" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">請選擇 <span class="caret"></span></button>
                                                <ul class="dropdown-menu">
                                                    <li rel-value="personnel"><a>全域通訊清單</a></li>
                                                    <li rel-value="dept"><a>部門清單</a></li>
                                                    <li rel-value="group"><a>群組清單</a></li>
                                                </ul>
                                            </div>
                                        </div>
                                        <input class="form-control txtCcFilterRange" type="text" style="display: none" />
                                    </td>
                                    <td>
                                        <input class="form-control txtCcSearch" type="text" />
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-primary btnCcSearch" title="Search" style="display: inline-block;"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="col-lg-12">
                            <div class="panel panel-default">
                                <ul class="list-group"></ul>
                                <div class="panel-footer">
                                    <ul class="pagination"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default modalCancel" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-info modalOK" data-dismiss="modal">確定</button>
                </div>
            </div>
        </div>
    </div>

    <!--挑選改變關卡對話框-->
    <div class="modal fade" id="SelectChangeStepModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">改變關卡</h4>
                </div>
                <div class="modal-body">
                    <div class="row-fluid">
                        <div class="col-lg-12">
                            <div class="panel panel-default">
                                <ul class="list-group" id="ChangeStep_result"></ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default modalCancel" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-info modalOK" data-dismiss="modal">確定</button>
                </div>
            </div>
        </div>
    </div>

    <!--挑選改變人員對話框-->
    <div class="modal fade" id="SelectChangeHandlerModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">改變人員</h4>
                </div>
                <div class="modal-body">
                    <div class="row-fluid">
                        <div class="col-lg-12">
                            <table style="width: 100%">
                                <tr>
                                    <td style="white-space: nowrap;">關卡名稱:&nbsp;</td>
                                    <td style="width: 100%"><span style="white-space: nowrap;"><select class="form-control cboSteps" style="width: 350px!important"></select></span></td>
                                    <td style="white-space: nowrap;">
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" class="ConferBySort" style="margin-top: 5px">依序加會
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="col-lg-12">
                            已選取範圍:<br />
                            <div type="text" class="form-control table Selected readOnly lblSelectedList" id="divSelected">
                                Loading...
                            </div>
                            <input type="text" class="form-control ReturnValue" style="display: none;" />
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="col-lg-12">
                            挑選範圍:
                        </div><!-- /.col-lg-6 -->
                    </div><!-- /.row -->
                    <div class="row-fluid">
                        <div class="col-lg-12">
                            <table style="width: 100%">
                                <tr>
                                    <td>
                                        <div class="input-group">
                                            <div class="input-group-btn selectHandler">
                                                <button type="button" class="btn btn-default dropdown-toggle" style="width: 100%; text-align: left" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">請選擇 <span class="caret"></span></button>
                                                <ul class="dropdown-menu">
                                                    <li rel-value="personnel"><a>全域通訊清單</a></li>
                                                    <li rel-value="dept"><a>部門清單</a></li>
                                                    <li rel-value="group"><a>群組清單</a></li>
                                                </ul>
                                            </div>
                                        </div>
                                        <input class="form-control txtFilterRange" type="text" style="display: none" />
                                    </td>
                                    <td>
                                        <input class="form-control txtSearch" type="text" />
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-primary btnSearch" title="Search" style="display: inline-block;"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="col-lg-12">
                            <div class="panel panel-default">
                                <ul class="list-group"></ul>
                                <div class="panel-footer">
                                    <ul class="pagination"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default modalCancel" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-info modalOK" data-dismiss="modal">確定</button>
                </div>
                <div style="display: none;">
                    <table>
                        <tr>
                            <td>changeAction:<br /><input class="changeAction" type="text" /></td>
                            <td>currentStepSn:<br /><input class="currentStepSn" type="text" /></td>
                            <td>currentStepName:<br /><input class="currentStepName" type="text" /></td>
                        </tr>
                        <tr>
                            <td>defaultNextStepSn:<br /><input class="defaultNextStepSn" type="text" /></td>
                            <td>defaultNextStepName:<br /><input class="defaultNextStepName" type="text" /></td>
                            <td>defaultNextHandler:<br /><input class="defaultNextHandler" type="text" /></td>
                        </tr>
                        <tr>
                            <td>defaultNextHandler2:<br /><input class="defaultNextHandler2" type="text" /></td>
                            <td>selectedIndex:<br /><input class="selectedIndex" type="text" /></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!--挑選退簽對話框-->
    <div class="modal fade" id="SelectReturnToModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">退簽</h4>
                </div>
                <div class="modal-body">
                    <div class="row-fluid">
                        <div class="col-lg-12">
                            <table>
                                <tr>
                                    <td>
                                        <div class="radio">
                                            <label>
                                                <input type="radio" name="ReturnTo" class="rdoToReSubmit" value="ReturnToReSubmit" disabled />
                                                退回申請者重簽
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="radio">
                                            <label>
                                                <input type="radio" name="ReturnTo" class="rdoToModify" value="ReturnToModify" disabled />
                                                退回申請者修改
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="radio">
                                            <label>
                                                <input style="display: inline-block;" type="radio" name="ReturnTo" class="rdoToPreviousHandler" value="ToPreviousHandler" disabled />
                                                退回前處理者(同一關卡)
                                            </label>
                                            <select class="cboPrevious form-control" style="width: 350px; display: inline-block;" disabled>
                                            </select>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="radio">
                                            <label>
                                                <input type="radio" name="ReturnTo" class="rdoToPreviousAll" value="ToPreviousAll" disabled />
                                                退回前關所有處理者
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="radio">
                                            <label>
                                                <input style="display: inline-block;" type="radio" name="ReturnTo" class="rdoToHandler" value="ToHandler" disabled />
                                                退回至
                                            </label>
                                            <select class="cboReturn form-control" style="width: 350px; display: inline-block;" disabled>
                                            </select>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="radio">
                                            <label>
                                                <input style="display: inline-block;" type="radio" name="ReturnTo" class="rdoToHandlerModify" value="ToHandlerModify" disabled />
                                                退回至
                                            </label>
                                            <select class="cboReturnModify form-control" style="width: 350px; display: inline-block;" disabled>
                                            </select>&nbsp;修改(不重簽)
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default modalCancel" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-info modalOK" data-dismiss="modal">確定</button>
                    <div style="display: none;">
                        <table>
                            <tr>
                                <td>BackApplant:<br /><input class="BackApplant" type="text" /></td>
                                <td>BackApplantModify:<br /><input class="BackApplantModify" type="text" /></td>
                                <td>PreviousHandler:<br /><input class="PreviousHandler" type="text" /></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/FormDesigner/bundles/jquery?v=rYaYAm3Qk7jTPf5-g-9rfW-e8F-TxnKnebXiKepZy8w1"></script>

    <script language="javascript" src="/BPM_TaskPane/bootstrap/js/bootstrap.min.js"></script>

    <script language="javascript" src="/BPM_TaskPane/jquery-ui-1.11.4/jquery-ui.js"></script>
    <script language="javascript" src="/BPM_TaskPane/jquery-ui-1.11.4/JQueryDatePickerTW.js"></script>
    <script language="javascript" src="/BPM_TaskPane/jquery-ui-1.11.4/datepicker-zh-TW.js"></script>
    <script language="javascript" src="/BPM_TaskPane/jquery-ui-1.11.4/jquery.blockUI.js"></script>

    <script language="javascript" src="/BPM_TaskPane/Scripts/respond.js"></script>
    <script language="javascript" src="/BPM_TaskPane/Scripts/summernote.js"></script>

    <script language="javascript" src="/BPM_TaskPane/Scripts/jquery.uploadfile.min.js"></script>
    <script language="javascript" src="/BPM_TaskPane/Scripts/borg.userdialog.js"></script>
    <script language="javascript" src="/BPM_TaskPane/Scripts/borg.customizedialog.js"></script>
    <script language="javascript" src="/BPM_TaskPane/Scripts/borg.uploadfile.js"></script>
    <script language="javascript" src="/BPM_TaskPane/Scripts/taskpane.js"></script>
    <script language="javascript" src="/BPM_TaskPane/Scripts/DrawGrid.js"></script>

    <script language="javascript" src="/BPM_TaskPane/Scripts/jquery.validate.js"></script>
    <script language="javascript" src="/BPM_TaskPane/Scripts/borg.validate.extend.js"></script>

    <script language="javascript" src="/BPM_TaskPane/Scripts/borg.formula.extend.js"></script>

    <script language="javascript" src="/BPM_TaskPane/Scripts/taskpane.extend.js"></script>

    <script>
$("#_92663 legend").attr("style", "display: none");
$("#_611995 legend").attr("style", "display: none");
$("#textBox003").attr("readOnly", "true");
$("#textBox009").attr("readOnly", "true");
$("#textBox010").attr("readOnly", "true");
var oSelector_dropDownList001 = $("#dropDownList001").find("option");
$(oSelector_dropDownList001[1]).prop('selected', true);
$("#_144934 legend").attr("style", "display: none");
$("#calendar001").addClass("IsRequired");
$("#calendar001").attr("dateformat", "yy/mm/dd");
$("#calendar001").attr("datestyle", 1911);
$("#calendar002").addClass("IsRequired");
$("#calendar002").attr("dateformat", "yy/mm/dd");
$("#calendar002").attr("datestyle", 1911);
$("#Hour").addClass("IsRequired");
$("#_833410 legend").attr("style", "display: none");
$("#textArea001").addClass("IsRequired");
$("#textArea001").attr("minlength", "4");
$("#textArea001").attr("maxlength", "100");
$("#textBox005").attr("readOnly", "true");
$("#_92663>legend").attr("style"," display:none; ");
$("#_611995>legend").attr("style"," display:none; ");
$("#_144934>legend").attr("style"," display:none; ");
$("#_833410>legend").attr("style"," display:none; ");
$("#_739485").attr("style"," font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; ");
$("#_739485 th").attr("style"," font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; ");
$("#_739485>legend").attr("style"," font-weight:inherit;font-style:inherit;display:inline-block; ");
$("#_262468").attr("style"," font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; ");
$("#_262468 input").attr("style"," font-weight:inherit;font-style:inherit; ");
$("#_518401").attr("style"," font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; ");
$("#_518401 input").attr("style"," font-weight:inherit;font-style:inherit; ");
$("#_459447").attr("style"," font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; ");
$("#_459447 input").attr("style"," font-weight:inherit;font-style:inherit; ");
$("#_245933 h1").attr("style"," font-weight:bold;font-style:inherit;font-family:微軟正黑體;font-size:24px; ");
$("#_138286").attr("style"," font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; ");
$("#_138286 input").attr("style"," font-weight:inherit;font-style:inherit; ");
$("#_912379").attr("style"," font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; ");
$("#_912379 textarea").attr("style"," height:70px; ");
$("#_841069").attr("style"," font-weight:inherit;font-style:inherit;font-size:inherit; ");
$("#_954799").attr("style"," font-weight:inherit;font-style:inherit;font-size:inherit; ");
$("#_950173 .divHTML").attr("style"," font-weight:bold;font-style:inherit;font-family:微軟正黑體;font-size:inherit; ");
$("#_308865 .divHTML").attr("style"," font-weight:bold;font-style:inherit;font-family:微軟正黑體;font-size:inherit; ");
$("#_778236").attr("style"," font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; ");
$("#_431127").attr("style"," font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; ");
$("#_431127 input").attr("style"," font-weight:inherit;font-style:inherit; ");
$("#_725612").attr("style"," font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; ");
$("#_725612 input").attr("style"," font-weight:inherit;font-style:inherit; ");
$("#_488388").attr("style"," font-weight:inherit;font-style:inherit;font-family:微軟正黑體;font-size:inherit; ");
$("#_488388 input").attr("style"," font-weight:inherit;font-style:inherit; ");



        /* panel-title的箭頭轉向效果 */
        $('.panel-title>a').click(function () {
            $(this).find('.glyphicon').toggleClass('glyphicon-chevron-right glyphicon-chevron-down')
        });

        /* 有設定名稱的row自動出現邊框 */
        $('legend').not(":hidden").parent('.row').addClass('rowWithLengend');

        /* 簽核區塊(處理者)的按鈕下拉選單 */
        $('#sign2 ul.dropdown-menu>li>a').click(function () {

            preNextTo = $('.txtRecever').attr('rel-nextto');
            preNextAlias = $('.txtRecever').attr('rel-nextalias');
            preclickA = $('#sign2').find('button.dropdown-toggle').html();
            preValue1 = $('.txtRecever').val();
            preValue2 = $('#txtRecever').val();
            preValue3 = $('#ReceiptList').val();

            $('.txtRecever').attr('rel-nextto', $(this).parent().attr('rel-value'));
            $('.txtRecever').attr('rel-nextalias', $(this).text());

            switch ($(this).parent().attr('rel-value')) {
                case 'defaultNextTo':
                    $('.txtRecever').val(defaultRecever);
                    $('#txtRecever').val(defaultRecever);
                    $('#ReceiptList').val(defaultReceiptList);

                    if (defaultRecever == oldRecever) $('#Mode').val('NORMAL');
                    break;

                case 'changeStep':
                    $('.txtRecever').val('');
                    $('#txtRecever').val('');
                    $('#ReceiptList').val('');

                    $("#SelectChangeStepModal").modal('show');
                    break;

                default:
                    $('.txtRecever').val('');
                    $('#txtRecever').val('');
                    $('#ReceiptList').val('');

                    $("#SelectChangeHandlerModal").modal('show');
                    break;
            }
            var clickA = $(this).text() + ' <span class="caret"></span>';
            $(this).parent().parent().parent().find('button.dropdown-toggle').html(clickA);
        });

        /* 簽核區塊(副本人員->挑選範圍)的按鈕下拉選單 */
        $('#SelectCcModal ul.dropdown-menu>li>a').click(function () {
            switch ($(this).parent().attr('rel-value')) {
                case 'personnel':
                    $('.txtCcSearch').attr('placeholder', '輸入姓名、帳號或e-mail');
                    break;
                case 'dept':
                    $('.txtCcSearch').attr('placeholder', '輸入部門編號、部門名稱');
                    break;
                case 'group':
                    $('.txtCcSearch').attr('placeholder', '輸入群組名稱');
                    break;
            }
            $('.txtCcFilterRange').val($(this).parent().attr('rel-value'));
            $('.txtCcFilterRange').attr('rel-filter', $(this).parent().attr('rel-value'));

            var clickA = $(this).text() + ' <span class="caret"></span>';
            $(this).parent().parent().parent().find('button.dropdown-toggle').html(clickA);
        });

        /* 簽核區塊(副本人員->挑選範圍)的按鈕下拉選單 */
        $('#SelectChangeHandlerModal ul.dropdown-menu>li>a').click(function () {
            switch ($(this).parent().attr('rel-value')) {
                case 'personnel':
                    $('.txtSearch').attr('placeholder', '輸入姓名、帳號或e-mail');
                    break;
                case 'dept':
                    $('.txtSearch').attr('placeholder', '輸入部門編號、部門名稱');
                    break;
                case 'group':
                    $('.txtSearch').attr('placeholder', '輸入群組名稱');
                    break;
            }
            $('.txtFilterRange').val($(this).parent().attr('rel-value'));
            $('.txtFilterRange').attr('rel-filter', $(this).parent().attr('rel-value'));

            var clickA = $(this).text() + ' <span class="caret"></span>';
            $(this).parent().parent().parent().find('button.dropdown-toggle').html(clickA);
        });

    </script>

    <script>

        var defaultReceiptList = '925(14);HR(蔡信志(0004))';
        var aryReceiptList = defaultReceiptList.split(';');
        var defaultRecever = aryReceiptList[aryReceiptList.length - 1];

        var defaultNextStepSn = '925;';
        var defaultNextStepName = 'HR;';
        var defaultNextHandler = '925(14);HR(蔡信志(0004))';
        var defaultNextHandler2 = null;

        var aryReturnValue = null;

        var currentStepSn = '924';
        var currentStepName = '主管審核';

        var preclickA = '';
        var preNextTo = '';
        var preNextAlias = '';
        var preValue1 = '';
        var preValue2 = '';
        var preValue3 = '';

        var oldRecever = '';

        var _active = null;

        var _cur_logon = "";
        var _tabPage = "1";

        var _curr_page = 1;
        var _total_pages = -1;
        var _page_begin = 1;
        var _page_end = -1;

        var _curr_page2 = 1;
        var _total_pages2 = -1;
        var _page_begin2 = 1;
        var _page_end2 = -1;

        var _returnContorl = "";

        var DeleteMyPhraseConfirm = "Are you sure you want to delete \"{0}\" phrase item?";
        var DeleteAttachmentConfirm = "Are you sure you want to delete \"{0}\" item?";

        var Sys_UserID = '17';
        var Sys_LogonID = '0007';
        var Sys_UserName = '徐佳馨';

        $(document).ready(function () {

            jQuery.validator.setDefaults({
                debug: true,
                success: "valid"
            });

            _cur_logon = $("#logon").val();

            oldRecever = $('.txtRecever').val();

            switch ($('#SPM_Level').val()) {
                case 'High':
                    $('button.btnipHigh').toggleClass('active');
                    if ($('#SPM_HandleType').val() == '3') {
                        $('button.btnipLow').attr('style', 'display: none;');
                    }
                    break;
                case 'Low':
                    if ($('#SPM_HandleType').val() == '3') {
                        $('button.btnipHigh').attr('style', 'display: none;');
                    }
                    $('button.btnipLow').toggleClass('active');
                    break;
                default:
                    if ($('#SPM_HandleType').val() == '3') {
                        $('button.btnipHigh').attr('style', 'display: none;');
                        $('button.btnipLow').attr('style', 'display: none;');
                    }
                    break;
            }

            $('#UploadAttachModal').find('.uploadAttach').uploadFile({
                url: "/FDService/uploadAttach.aspx",
                formData: {
                    caseid: document.getElementById('SPM_CaseId').value,
                    taskid: document.getElementById('SPM_TaskId').value,
                    handler: document.getElementById('HANDLERID').value,
                    object: '.BgImg'
                },
                sequential: true,
                sequentialCount: 1,
                allowedTypes: "*",
                showDelete: false,
                showPreview: false,
                showFileCounter: false,
                "jquery-upload-file-error": "File already exists",
                onSuccess: function (files, data, xhr, pd) {
                    //files: list of files
                    //data: response from server
                    //xhr : jquer xhr object
                    var ary = data.split('|');
                    if (ary[0] == "OK") {
                        var ary1 = ary[1].split(';');
                        for (var idx = 0; idx <= ary1.length - 1; idx++) {
                            if (ary1[idx] != "") {
                                var temp = $(".txtUpload2").val();
                                temp += ($(".txtUpload2").val() != "" ? ";" : "");
                                temp += ary1[idx];
                                $(".txtUpload2").val(temp);
                            }
                        }
                        ReloadAttachemtList();
                    }
                    else {
                        alert(data);
                    }
                },
                deleteCallback: function (data, pd) {
                }
            });

            /* 重要性按鈕 單選+可取消 */
            $('button.btnipLow').click(buttonGroup_One);
            $('button.btnipHigh').click(buttonGroup_One);
            function buttonGroup_One() {
                if ($('#SPM_HandleType').val() != '3') {
                    $(this).parent().children('button').not($(this)).removeClass('active');
                    $(this).toggleClass('active');
                }
            }

            /* 顯示附件檔案清單 */
            ShowAttachmentList();

            /* 功能鈕click event */
            $(".btnReturn").click(function () {
                $("#SelectReturnToModal").modal('show');
            });
            $(".btnSave").click(function () {
                _SPM_Save();
            });
            $(".btnSend").click(function () {
                var validator = $('#form1').validate({
                    errorPlacement: function (error, element) {
                        error.attr('style', 'display: inline-block;');
                        switch ($(element).attr('type')) {
                            case 'radio':
                            case 'checkbox':
                                error.insertAfter($(element).parent().parent().find('label:last'));
                                break;
                            default:
                                var bFound = false;
                                if (element.attr('class') != null) {
                                    if (element.attr('class').indexOf('userdialog') != -1) {
                                        error.insertAfter(element.parent().find('input.btn'));
                                        bFound = true;
                                    }
                                    else if (element.attr('class').indexOf('summernote') != -1) {
                                        error.insertAfter(element.parent().find('div.note-editor'));
                                        bFound = true;
                                    }
                                }
                                if (element.parent().attr('class') != null) {
                                    if (element.parent().attr('class').indexOf('customizeDialog') != -1) {
                                        error.insertAfter(element.parent().find('input.btn'));
                                        bFound = true;
                                    }
                                }
                                if (!bFound) error.insertAfter(element);
                                break;
                        }
                    }
                });
                //必填
                var oSelector = $('#form1 .IsRequired');
                for (var idx = 0; idx <= oSelector.length - 1; idx++) {
                    if ($(oSelector[idx]).attr('emptystring') == null) {
                        $('#' + $(oSelector[idx]).attr('id')).rules("add", {
                            required: true,
                            messages: {
                                required: "<font color=red>必須填寫</font>"
                            }
                        });
                    }
                    else {
                        $('#' + $(oSelector[idx]).attr('id')).rules("add", {
                            IsNotEmpty: $(oSelector[idx]).attr('emptystring'),
                            messages: {
                                IsNotEmpty: "<font color=red>必須填寫</font>"
                            }
                        });
                    }
                }
                //輸入長度限制(最小長度)
                oSelector = $('#form1 [minlength]');
                for (var idx = 0; idx <= oSelector.length - 1; idx++) {
                    $('#' + $(oSelector[idx]).attr('id')).rules("add", {
                        minlength: parseInt($(oSelector[idx]).attr('minlength')),
                        messages: {
                            minlength: "<font color=red>必須輸入至少" + $(oSelector[idx]).attr('minlength') + "字元</font>"
                        }
                    });
                }
                //禁用特殊字元
                oSelector = $('#form1 [illegalchar]');
                for (var idx = 0; idx <= oSelector.length - 1; idx++) {
                    $('#' + $(oSelector[idx]).attr('id')).rules("add", {
                        IllegalChar: $(oSelector[idx]).attr('illegalchar'),
                        messages: {
                            IllegalChar: "<font color=red>禁用特殊字元 (" + $(oSelector[idx]).attr('illegalchar') + ")</font>"
                        }
                    });
                }

                var bValid = $('#form1').valid();
                if (FormValidate != null) bValid = bValid & FormValidate(validator);
                if (bValid) {
                    _SPM_Send();
                }
            });
            $(".btnPrevious").click(function () {
                SPM_Previous();
            });
            $(".btnNext").click(function () {
                SPM_Next();
            });
            $(".btnRecall").click(function () {
                if (!confirm("是否確定執行抽單動作 ?")) return;

                document.getElementById("SPM_HandleType").value = 'AutoRecall';
                SPM_Send();
            });
            $(".btnBackout").click(function () {
                if (!confirm("是否確定執行撤銷動作 ?")) return;

                document.getElementById("SPM_HandleType").value = 'AutoBackout';
                SPM_Send();
            });
            $(".btnFlowChart").click(function () {
                _SPM_FlowChart();
            });
            $(".btnPrint").click(function () {
                SPM_Print();
            });
            $(".btnNextTo").click(function () {
                switch ($('.txtRecever').attr('rel-nextto')) {
                    case 'defaultNextTo':
                        if ($('#CanAssignHandler').val() == 'True') $("#SelectChangeHandlerModal").modal('show');
                        break;
                    case 'changeStep':
                        $("#SelectChangeStepModal").modal('show');
                        break;
                    case 'confer':
                    case 'reassign':
                    case 'move':
                        $("#SelectChangeHandlerModal").modal('show');
                        break;
                }
            });
            $(".btnCc").click(function () {
                $("#SelectCcModal").modal('show');
            });
            $(".btnOpinions").click(function () {
                $("#PhraseModal").modal('show');

                _returnContorl = ".txtOPINION";
            });
            $(".btnMemos").click(function () {
                $("#PhraseModal").modal('show');

                _returnContorl = ".txtMemo";
            });
            $(".btnUploadAttach").click(function () {
                $("#UploadAttachModal").modal('show');

                _returnContorl = ".txtMemo";
            });

            /* ReturnTo Modal */
            $('#SelectReturnToModal').on('show.bs.modal', function (event) {

                if (!$('#SelectReturnToModal .rdoToReSubmit').is(':disabled')) {
                    $('#SelectReturnToModal .rdoToReSubmit').prop('checked', true);
                }
                else if (!$('#SelectReturnToModal .rdoToModify').is(':disabled')) {
                    $('#SelectReturnToModal .rdoToModify').prop('checked', true);
                }
                else if (!$('#SelectReturnToModal .rdoToPreviousHandler').is(':disabled')) {
                    $('#SelectReturnToModal .rdoToPreviousHandler').prop('checked', true);
                }
                else if (!$('#SelectReturnToModal .rdoToPreviousAll').is(':disabled')) {
                    $('#SelectReturnToModal .rdoToPreviousAll').prop('checked', true);
                }
                else if (!$('#SelectReturnToModal .rdoToHandler').is(':disabled')) {
                    $('#SelectReturnToModal .rdoToHandler').prop('checked', true);
                }
                else if (!$('#SelectReturnToModal .rdoToHandlerModify').is(':disabled')) {
                    $('#SelectReturnToModal .rdoToHandlerModify').prop('checked', true);
                }
            });
            $('#SelectReturnToModal').find('.modalOK').click(function () {

                var returnValue = "";

                //退回申請者(重簽)
                if ($('#SelectReturnToModal .rdoToReSubmit').is(':checked')) {
                    returnValue = $('#SelectReturnToModal .BackApplant').val() + "|RETURN|RESUBMIT";
                }
                //退回申請者修改
                if ($('#SelectReturnToModal .rdoToModify').is(':checked')) {
                    returnValue = $('#SelectReturnToModal .BackApplantModify').val() + "|RETURN|MODIFY";
                }
                //退回同一關卡處理者
                if ($('#SelectReturnToModal .rdoToPreviousHandler').is(':checked')) {
                    var selectedValue = $('#SelectReturnToModal .cboPrevious').val();

                    var oSelector = $('#SelectReturnToModal .cboPrevious>option[value=\"' + selectedValue + '\"]');
                    if (oSelector.length > 0) {
                        $('#SelectReturnToModal .PreviousHandler').val(selectedValue + oSelector[0].text);
                        returnValue = $('#SelectReturnToModal .PreviousHandler').val() + "|RETURN";
                    }
                }
                //退回前關所有處理者
                if ($('#SelectReturnToModal .rdoToPreviousAll').is(':checked')) {
                    var oSelector = $('#SelectReturnToModal .cboReturn>option');
                    if (oSelector.length > 0) {
                        returnValue = $(oSelector[0]).val() + oSelector[0].text + "|RETURN";
                    }
                }
                //退回至
                if ($('#SelectReturnToModal .rdoToHandler').is(':checked')) {
                    var selectedValue = $('#SelectReturnToModal .cboReturn').val();

                    var oSelector = $('#SelectReturnToModal .cboReturn>option[value=\"' + selectedValue + '\"]');
                    if (oSelector.length > 0) {
                        returnValue = selectedValue + oSelector[0].text + "|RETURN";
                    }
                }
                //退回至修改(不重簽)
                if ($('#SelectReturnToModal .rdoToHandlerModify').is(':checked')) {
                    var selectedValue = $('#SelectReturnToModal .cboReturnModify').val();

                    var oSelector = $('#SelectReturnToModal .cboReturnModify>option[value=\"' + selectedValue + '\"]');
                    if (oSelector.length > 0) {
                        returnValue = selectedValue + oSelector[0].text + "|RETURN|APPROVERMODIFY";
                    }
                }

                if ((returnValue != "-1") && (returnValue != "")) {
                    var aryItem = returnValue.split("|");
                    var aryItem1 = aryItem[2].split(";");

                    $(".txtRecever").val(aryItem[2].substring(aryItem1[0].length + 1));
                    $("#txtRecever").val(aryItem[2].substring(aryItem1[0].length + 1));
                    $("#ReceiptList").val(aryItem[2]);
                    $("#Mode").val(aryItem[3]);
                    $("#SPM_Action").val("Return");
                    doReject = true;
                    if ((aryItem.length - 1) == 4)
                        $("#Mode").val($("#Mode").val() + "|" + aryItem[4]);
                    SPM_Send();
                }
            });

            /* Phrase Modal */
            $('#PhraseModal').on('show.bs.modal', function (event) {
                _active = null;

                _cur_logon = $('#logon').val();
                _curr_page = 1;
                _total_pages = -1;
                _page_begin = 1;
                _page_end = -1;
                QueryPhraseData();

                _curr_page2 = 1;
                _total_pages2 = -1;
                _page_begin2 = 1;
                _page_end2 = -1;
                QueryMyPhraseData();
            });
            $('#PhraseModal').find('.modalOK').click(function () {
                if (_active != null) {

                    if (_tabPage == "1") {
                        $(_returnContorl).val($('.txtOPINION').val() + $(_active).attr("rel-value"));

                        _active = null;
                    }
                    else {
                        var _random = Math.random();

                        $.ajax({
                            type: 'GET',
                            url: '/FDService/updateMyPhrase.aspx',                   //web service的URI
                            data: 'logon=' + _cur_logon + '&sn=' + $(_active).attr("rel-sn") + '&data=' + escape($("#txt" + _active.attr("id")).val()) + '&random=' + _random,  //參數,JSON字串型態
                            beforeSend: function () {
                                $.blockUI({ message: '<div style="font-size: 16px"><br /><img src="' + loadingImage + '" style="width: 26px" />&nbsp;' + LoadingMsg + '<br /><br /></div>' });
                            },
                            complete: function () {
                                $.unblockUI();
                            },
                            error: function (xhr, textStatus, errorThrown) {
                                $.unblockUI();
                                alert('An error occurred! ' + errorThrown);
                            },
                            success: function (responseData, textStatus, jqXHR) {
                                $.unblockUI();

                                if (responseData == "OK") {
                                    $(_returnContorl).val($(_returnContorl).val() + $("#txt" + _active.attr("id")).val());
                                }
                                else {
                                    alert("Exception: " + responseData);
                                }

                                _active = null;
                            }
                        });
                    }
                }
            });
            $('#PhraseModal').find('.modalCancel').click(function () {
                _active = null;
            });

            /* Attachments Modal */
            $('#UploadAttachModal').on('show.bs.modal', function (event) {
                $(".txtUpload2").val($(".txtUpload").val());

                ReloadAttachemtList();
            });
            $('#UploadAttachModal').find('.modalClose').click(function () {
                $(".txtUpload").val($(".txtUpload2").val())

                ShowAttachmentList();
            });
            $('.btnAddLinkFile').click(function () {
                if ($('.txtLinkFilename').val() == '') return;

                var _random = Math.random();
                //
                $.ajax({
                    type: 'GET',
                    url: '/FDService/addAttachLink.aspx',                   //web service的URI
                    data: 'logon=' + _cur_logon + '&caseid=' + $("#SPM_CaseId").val() + '&taskid=' + $("#SPM_TaskId").val() + '&data=' + escape($('.txtLinkFilename').val()) + '&random=' + _random,  //參數,JSON字串型態
                    beforeSend: function () {
                        $.blockUI({ message: '<div style="font-size: 16px"><br /><img src="' + loadingImage + '" style="width: 26px" />&nbsp;' + LoadingMsg + '<br /><br /></div>' });
                    },
                    complete: function () {
                        $.unblockUI();
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        $.unblockUI();
                        alert('An error occurred! ' + errorThrown);
                    },
                    success: function (responseData, textStatus, jqXHR) {
                        $.unblockUI();

                        if (responseData == "OK") {
                            ReloadAttachemtList();
                            $('.txtLinkFilename').val('');
                        }
                        else {
                            alert(responseData);
                        }
                    }
                });
            });

            /* Cc Modal */
            $('#SelectCcModal').on('show.bs.modal', function (event) {

                var temp = $('#SPM_txtCC').val();

                if ($('#SPM_txtCC').val() != '') {
                    $('.SPM_txtCC').val('U,' + $('#SPM_txtCC').val().replace(/;/gi, ';U,'));
                }

                ShowCcSelectedList();

                $('.txtCcSearch').html('');

                //li disabled
                $('#SelectCcModal ul.list-group').html('');

                var ul = $('#SelectCcModal ul.list-group');
                for (idx = 0; idx < 5; idx++) {
                    li = $("<li></li>").html("&nbsp;");
                    li.attr("class", "list-group-item disabled");
                    ul.append(li);
                }
            });
            $('#SelectCcModal').find('.modalOK').click(function () {

                var _random = Math.random();

                $.ajax({
                    type: 'GET',
                    url: '/FDService/expandCcSelectedList.aspx',                   //web service的URI
                    data: 'logon=' + _cur_logon + '&selected=' + escape($('.SPM_txtCC').val()) + '&random=' + _random,  //參數,JSON字串型態
                    beforeSend: function () {
                        $.blockUI({ message: '<div style="font-size: 16px"><br /><img src="' + loadingImage + '" style="width: 26px" />&nbsp;' + LoadingMsg + '<br /><br /></div>' });
                    },
                    complete: function () {
                        $.unblockUI();
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        $.unblockUI();
                        alert('An error occurred! ' + errorThrown);
                    },
                    success: function (responseData, textStatus, jqXHR) {
                        $.unblockUI();

                        if (responseData != "") {
                            var ary = responseData.split('|');
                            $('#SPM_txtCC').val(ary[0]);
                            $('.SPM_txtCC').val(ary[0]);

                            $('#txtCC').val(ary[1]);
                            $('.txtCC').val(ary[1]);
                        }
                    }
                });

                if ($('.SPM_txtCC').val() == '') {
                    $('#SPM_txtCC').val('');
                    $('.SPM_txtCC').val('');

                    $('#txtCC').val('');
                    $('.txtCC').val('');
                }

            });
            $('.btnCcSearch').click(function () {

                if ($('.txtCcFilterRange').val() == '') return;

                _cur_logon = $('#logon').val();
                _curr_page = 1;
                _total_pages = -1;
                _page_begin = 1;
                _page_end = -1;

                switch ($('.txtCcFilterRange').attr('rel-filter')) {
                    case 'personnel':
                        QueryPersonnelData('#SelectCcModal', $('.txtCcSearch').val(), $('.SPM_txtCC'), ShowCcSelectedList);
                        break;
                    case 'dept':
                        QueryDepartmentData('#SelectCcModal', $('.txtCcSearch').val(), $('.SPM_txtCC'), ShowCcSelectedList);
                        break;
                    case 'group':
                        QueryGroupData('#SelectCcModal', $('.txtCcSearch').val(), $('.SPM_txtCC'), ShowCcSelectedList);
                        break;
                }
            });

            /*  ChangeStep Modal  */
            $('#SelectChangeStepModal').on('show.bs.modal', function (event) {
                _active = null;

                _cur_logon = $('#logon').val();
                _curr_page = 1;
                _total_pages = -1;
                _page_begin = 1;
                _page_end = -1;

                $('#SelectChangeStepModal ul.list-group').html('');

                var ul = $('#SelectChangeStepModal ul.list-group');

                var aryStep = $('#RangeChangeStep').val().split('$');
                for (var i = 0; i <= aryStep.length - 1; i++) {
                    var ary = aryStep[i].split('|');

                    var li = $("<li></li>")
                        .html("<span class=\"ellipsis\" style=\"display: inline-block;\">" + ary[1] + "</span>")
                        .attr("class", "list-group-item");

                    li.attr("id", "ChangeStep_item_" + i);
                    li.attr("style", "cursor: pointer");
                    li.attr("rel-value", ary[1]);
                    li.attr("rel-id", aryStep[i]);
                    li.attr("title", ary[1]);

                    li.click(function () {
                        //Selected(this.id);
                        if (_active != null) {
                            $("#" + _active.attr("id")).html("<span class='ellipsis' style='display: inline-block;' title='" + $("#" + _active.attr("id")).attr("rel-value") + "'>" + $("#" + _active.attr("id")).attr("rel-value") + "</span>");

                            _active.attr("class", "list-group-item");
                        }

                        _active = $("#" + this.id);
                        $("#" + _active.attr("id")).html("<span class='ellipsis' style='display: inline-block;' title='" + $("#" + _active.attr("id")).attr("rel-value") + "'>" + $("#" + _active.attr("id")).attr("rel-value") + "</span><span style='display: inline-block;' class='glyphicon glyphicon-ok' aria-hidden='true'></span>");
                        _active.attr("class", "list-group-item seleted");
                    });
                    ul.append(li);
                }
            });
            $('#SelectChangeStepModal').find('.modalOK').click(function () {
                if (_active != null) {
                    var aryItem = $(_active).attr("rel-id").split('|');
                    var aryItem1 = aryItem[2].split(";");

                    $('.txtRecever').val(aryItem1[aryItem1.length - 1]);
                    $('#txtRecever').val(aryItem1[aryItem1.length - 1]);
                    $('#ReceiptList').val(aryItem[2]);
                    $('#Mode').val(aryItem[3]);
                    _active = null;
                }
                preValue1 = '';
                preValue2 = '';
                preValue3 = '';
            });
            $('#SelectChangeStepModal').find('.modalCancel').click(function () {

                if (preNextTo != '') $('.txtRecever').attr('rel-nextto', preNextTo);
                if (preNextAlias != '') $('.txtRecever').attr('rel-nextalias', preNextAlias);
                if (preclickA != '') $('#sign2').find('button.dropdown-toggle').html(preclickA);

                if (preValue1 != '') $('.txtRecever').val(preValue1);
                if (preValue2 != '') $('#txtRecever').val(preValue2);
                if (preValue3 != '') $('#ReceiptList').val(preValue3);

                preNextTo = '';
                preNextAlias = '';
                preclickA = '';
                preValue1 = '';
                preValue2 = '';
                preValue3 = '';
            });

            /* ChangeHandler Modal */
            $('#SelectChangeHandlerModal').on('show.bs.modal', function (event) {
                _active = null;

                _cur_logon = $('#logon').val();
                _curr_page = 1;
                _total_pages = -1;
                _page_begin = 1;
                _page_end = -1;

                $(this).find('.modal-title').html($('.txtRecever').attr('rel-nextalias'));

                $(this).find('.currentStepSn').val(currentStepSn);
                $(this).find('.currentStepName').val(currentStepName);
                $(this).find('.defaultNextStepSn').val(defaultNextStepSn);
                $(this).find('.defaultNextStepName').val(defaultNextStepName);
                $(this).find('.defaultNextHandler').val(defaultNextHandler);

                var ary = defaultNextHandler.split(';');
                defaultNextHandler2 = ary[ary.length - 1];

                ary = defaultNextStepName.split(';');
                for (idx = 0; idx <= ary.length - 1; idx++) {
                    if (ary[idx] != '') {
                        defaultNextHandler2 = defaultNextHandler2.replace(ary[idx] + '(', ';');
                    }
                }
                if (defaultNextHandler2.length > 0) defaultNextHandler2 = defaultNextHandler2.substring(1, defaultNextHandler2.length - 1);
                $(this).find('.defaultNextHandler2').val(defaultNextHandler2);

                var dropdown = $('#SelectChangeHandlerModal .cboSteps');
                dropdown.html('');

                $(dropdown).change(function () {
                    var tempStepSn = $(this).val();

                    var arySn = defaultNextStepSn.split(';');

                    for (var idx = 0; idx <= arySn.length - 1; idx++) {

                        var old_pos = parseInt($('#SelectChangeHandlerModal .selectedIndex').val());
                        aryReturnValue[old_pos] = $('#SelectChangeHandlerModal .ReturnValue').val();

                        if (arySn[idx] == tempStepSn) {
                            $('#SelectChangeHandlerModal .selectedIndex').val(idx);
                            $('#SelectChangeHandlerModal .ReturnValue').val(aryReturnValue[idx]);

                            ShowChangeHandlerSelectedList();
                        }
                    }
                });

                switch ($('.txtRecever').attr('rel-nextto')) {
                    case 'confer':
                        $('#SelectChangeHandlerModal .selectHandler li[rel-value=\"dept\"]').addClass('hidden');
                        $('#SelectChangeHandlerModal .selectHandler li[rel-value=\"group\"]').addClass('hidden');
                        $('#SelectChangeHandlerModal .ConferBySort').parent().removeClass('hidden');

                        $('#SelectChangeHandlerModal .selectHandler li[rel-value=\"personnel\"]>a').click();
                        break;
                    default:
                        $('#SelectChangeHandlerModal .selectHandler li[rel-value=\"dept\"]').removeClass('hidden');
                        $('#SelectChangeHandlerModal .selectHandler li[rel-value=\"group\"]').removeClass('hidden');
                        $('#SelectChangeHandlerModal .ConferBySort').parent().addClass('hidden');

                        $('#SelectChangeHandlerModal .ConferBySort').prop('checked', false);
                        break;
                }

                var option = '';
                switch ($('.txtRecever').attr('rel-nextto')) {
                    case 'confer':
                        $(this).find('.changeAction').val('CONFER');
                        option = $('<option></option>')
                                    .prop('selected', true)
                                    .attr('value', currentStepSn)
                                    .html(currentStepName);
                        dropdown.append(option);
                        break;
                    case 'reassign':
                        $(this).find('.changeAction').val('REASSIGN');
                        option = $('<option></option>')
                                    .prop('selected', true)
                                    .attr('value', currentStepSn)
                                    .html(currentStepName);
                        dropdown.append(option);
                        break;
                    case 'move':
                        $(this).find('.changeAction').val('MOVE');
                        break;
                    default:
                        $(this).find('.changeAction').val($('.txtRecever').attr('rel-nextto'));
                        var aryStepSn = defaultNextStepSn.split(';');
                        var aryStepName = defaultNextStepName.split(';');
                        var aryHandler = defaultNextHandler.split(';')
                        var aryHandler2 = defaultNextHandler2.split(';')

                        for (var idx = 0; idx <= aryStepName.length - 1; idx++) {
                            if (aryStepName[idx] != '') {
                                option = $('<option></option>')
                                    .attr('value', aryStepSn[idx])
                                    .html(aryStepName[idx]);
                                dropdown.append(option);
                                if (idx == 0) {
                                    option.prop('selected', true);
                                }
                            }
                        }

                        var ret = '';
                        for (var idx = 0; idx <= aryStepName.length - 1; idx++) {
                            if (aryStepName[idx] != '') {
                                var temp1 = aryHandler[idx].replace(aryStepSn[idx] + '(', '').replace(')', '').split(',');
                                var temp2 = aryHandler2[idx].split(',');

                                ret += (ret == '' ? '' : '^');
                                for (var idx1 = 0; idx1 <= temp1.length - 1; idx1++) {
                                    if (temp1[idx1] != '') {
                                        ret += (idx1 == 0 ? '' : ';');
                                        ret += 'U,' + temp1[idx1] + ',' + temp2[idx1];
                                    }
                                }
                            }
                        }

                        aryReturnValue = ret.split('^');
                        $('#SelectChangeHandlerModal .selectedIndex').val('0');
                        $('#SelectChangeHandlerModal .ReturnValue').val(aryReturnValue[0]);
                        break;
                }

                ShowChangeHandlerSelectedList();

                var ul = $('#SelectChangeHandlerModal ul.list-group');
                $(ul).html('');
                for (idx = 0; idx < 5; idx++) {
                    li = $("<li></li>").html("&nbsp;");
                    li.attr("class", "list-group-item disabled");
                    ul.append(li);
                }
            });
            $('#SelectChangeHandlerModal').find('.modalCancel').click(function () {

                if (preNextTo != '') $('.txtRecever').attr('rel-nextto', preNextTo);
                if (preNextAlias != '') $('.txtRecever').attr('rel-nextalias', preNextAlias);
                if (preclickA != '') $('#sign2').find('button.dropdown-toggle').html(preclickA);

                if (preValue1 != '') $('.txtRecever').val(preValue1);
                if (preValue2 != '') $('#txtRecever').val(preValue2);
                if (preValue3 != '') $('#ReceiptList').val(preValue3);

                preNextTo = '';
                preNextAlias = '';
                preclickA = '';
                preValue1 = '';
                preValue2 = '';
                preValue3 = '';
            });
            $('#SelectChangeHandlerModal .btnSearch').click(function () {

                if ($('.txtFilterRange').val() == '') return;

                _cur_logon = $('#logon').val();
                _curr_page = 1;
                _total_pages = -1;
                _page_begin = 1;
                _page_end = -1;

                switch ($('.txtFilterRange').attr('rel-filter')) {
                    case 'personnel':
                        QueryPersonnelData('#SelectChangeHandlerModal', $('.txtSearch').val(), $('.ReturnValue'), ShowChangeHandlerSelectedList);
                        break;
                    case 'dept':
                        QueryDepartmentData('#SelectChangeHandlerModal', $('.txtSearch').val(), $('.ReturnValue'), ShowChangeHandlerSelectedList);
                        break;
                    case 'group':
                        QueryGroupData('#SelectChangeHandlerModal', $('.txtSearch').val(), $('.ReturnValue'), ShowChangeHandlerSelectedList);
                        break;
                }
            });
            $('#SelectChangeHandlerModal').find('.modalOK').click(function () {

                var url = '/FDService/expandCcSelectedList.aspx';

                var _random = Math.random();

                var returnValue = '';
                switch ($('#SelectChangeHandlerModal .changeAction').val()) {
                    case 'CONFER':
                        url = '/FDService/expandConferSelectedList.aspx';
                        returnValue = $('.ReturnValue').val();
                        break;

                    case 'REASSIGN':
                    case 'MOVE':
                        returnValue = $('.ReturnValue').val();
                        break;

                    case 'defaultNextTo':
                        var old_pos = parseInt($('#SelectChangeHandlerModal .selectedIndex').val());
                        aryReturnValue[old_pos] = $('#SelectChangeHandlerModal .ReturnValue').val();

                        for (var idx = 0; idx <= aryReturnValue.length - 1; idx++) {
                            returnValue += (returnValue == '' ? '' : '^');
                            returnValue += aryReturnValue[idx];
                        }
                        break;
                }

                $.ajax({
                    type: 'GET',
                    url: url,                           //web service的URI
                    data: 'logon=' + _cur_logon + '&selected=' + escape(returnValue) + '&random=' + _random,  //參數,JSON字串型態
                    beforeSend: function () {
                        $.blockUI({ message: '<div style="font-size: 16px"><br /><img src="' + loadingImage + '" style="width: 26px" />&nbsp;' + LoadingMsg + '<br /><br /></div>' });
                    },
                    complete: function () {
                        $.unblockUI();
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        $.unblockUI();
                        alert('An error occurred! ' + errorThrown);
                    },
                    success: function (responseData, textStatus, jqXHR) {
                        $.unblockUI();

                        if (responseData != "") {
                            switch ($('#SelectChangeHandlerModal .changeAction').val()) {
                                case 'CONFER':
                                case 'REASSIGN':
                                case 'MOVE':
                                    var value1 = '';
                                    var value2 = '';
                                    var ary = responseData.split('|');
                                    ary = ary[0].split(';');
                                    for (var idx = 0; idx <= ary.length - 1; idx++) {
                                        var aryItem = ary[idx].split(',');
                                        value1 += (value1 == '' ? '' : ',');
                                        value1 += aryItem[0];

                                        value2 += (value2 == '' ? '' : ',');
                                        value2 += aryItem[1];
                                    }
                                    if ($('#SelectChangeHandlerModal .changeAction').val() == "CONFER") {
                                        if ($('#SelectChangeHandlerModal .currentStepSn').val() == "-98") {
                                            value1 = $('#SelectChangeHandlerModal .defaultNextStepSn').val().replace(';', '') + '(' + value1 + ')';
                                            value2 = $('#SelectChangeHandlerModal .defaultNextStepName').val().replace(';', '') + '(' + value2 + ')';
                                        }
                                        else {
                                            value1 = $('#SelectChangeHandlerModal .currentStepSn').val() + '(' + value1 + ')';
                                            value2 = $('#SelectChangeHandlerModal .currentStepName').val() + '(' + value2 + ')';
                                        }
                                    }
                                    else {
                                        value1 = $('#SelectChangeHandlerModal .currentStepSn').val() + '(' + value1 + ')';
                                        value2 = $('#SelectChangeHandlerModal .currentStepName').val() + '(' + value2 + ')';
                                    }

                                    $('#txtRecever').val(value2);
                                    $('#ReceiptList').val(value1 + ';' + value2);
                                    $('#Mode').val($('#SelectChangeHandlerModal .changeAction').val());

                                    $('.txtRecever').val(value2);

                                    if ($('#SelectChangeHandlerModal .changeAction').val() == "CONFER") {
                                        if ($('#url').val().indexOf('&ConferBySort=') >= 0) {
                                            if ($('#SelectChangeHandlerModal .ConferBySort').is(':checked')) {
                                                $('#url').val($('#url').val().replace('&ConferBySort=false', '&ConferBySort=true'));
                                            }
                                            else {
                                                $('#url').val($('#url').val().replace('&ConferBySort=true', '&ConferBySort=false'));
                                            }
                                        }
                                        else {
                                            if ($('#SelectChangeHandlerModal .ConferBySort').is(':checked')) {
                                                $('#url').val($('#url').val() + '&ConferBySort=true');
                                            }
                                            else {
                                                $('#url').val($('#url').val() + '&ConferBySort=false');
                                            }
                                        }
                                    }
                                    break;

                                case 'defaultNextTo':

                                    var aryStepSn = defaultNextStepSn.split(';');
                                    var aryStepName = defaultNextStepName.split(';');

                                    var value1_All = '';
                                    var value2_All = '';

                                    var ary1 = responseData.split('^');
                                    for (var idx1 = 0; idx1 <= ary1.length - 1; idx1++) {
                                        var value1 = '';
                                        var value2 = '';

                                        var ary2 = ary1[idx1].split('|');
                                        ary2 = ary2[0].split(';');
                                        for (var idx2 = 0; idx2 <= ary2.length - 1; idx2++) {
                                            var aryItem = ary2[idx2].split(',');
                                            value1 += (value1 == '' ? '' : ',');
                                            value1 += aryItem[0];

                                            value2 += (value2 == '' ? '' : ',');
                                            value2 += aryItem[1];
                                        }
                                        value1 = aryStepSn[idx1] + '(' + value1 + ')';
                                        value2 = aryStepName[idx1] + '(' + value2 + ')';

                                        value1_All += (value1_All == '' ? '' : ';');
                                        value1_All += value1;
                                        value2_All += value2;
                                    }

                                    //var ary = responseData.split('|');
                                    //ary = ary[0].split(';');
                                    //for (var idx = 0; idx <= ary.length - 1; idx++) {
                                    //    var aryItem = ary[idx].split(',');
                                    //    value1 += (value1 == '' ? '' : ',');
                                    //    value1 += aryItem[0];

                                    //    value2 += (value2 == '' ? '' : ',');
                                    //    value2 += aryItem[1];
                                    //}
                                    //value1 = $('#SelectChangeHandlerModal .currentStepSn').val() + '(' + value1 + ')';
                                    //value2 = $('#SelectChangeHandlerModal .currentStepName').val() + '(' + value2 + ')';

                                    $('#txtRecever').val(value2_All);
                                    $('#ReceiptList').val(value1_All + ';' + value2_All);
                                    $('#Mode').val("ASSIGN");

                                    $('.txtRecever').val(value2_All);

                                    defaultNextHandler = value1_All + ';' + value2_All;
                                    break;
                            }
                        }
                    }
                });
            });
        });

        /* Phrase & MyPhrase function */
        function TabPage(page) {
            if (_active != null) {
                $("#" + _active.attr("id")).html("<span class='ellipsis' style='display: block;' title='" + $("#" + _active.attr("id")).attr("rel-value") + "'>" + $("#" + _active.attr("id")).attr("rel-value") + "</span>");

                _active.attr("class", "list-group-item");

                _active = null;
            }

            _tabPage = page;
        }
        function QueryPhraseData() {

            _active = null;

            var _random = Math.random();

            $.ajax({
                type: 'GET',
                url: '/FDService/getPhraseByPage.aspx',                   //web service的URI
                data: 'logon=' + _cur_logon + '&page=' + _curr_page + '&random=' + _random,  //參數,JSON字串型態
                beforeSend: function () {
                    $.blockUI({ message: '<div style="font-size: 16px"><br /><img src="' + loadingImage + '" style="width: 26px" />&nbsp;' + LoadingMsg + '<br /><br /></div>' });
                },
                complete: function () {
                    $.unblockUI();
                },
                error: function (xhr, textStatus, errorThrown) {
                    $.unblockUI();
                    alert('An error occurred! ' + errorThrown);
                },
                success: function (responseData, textStatus, jqXHR) {
                    $.unblockUI();

                    if (responseData != "") {

                        var data;
                        var string = responseData;
                        if (window.JSON != undefined) {
                            data = JSON.parse(string);
                        }
                        else {
                            data = eval("(" + string + ")");
                        }
                        $('#SystemPhrases_result').html("");

                        var ul = $('#SystemPhrases_result');
                        for (i = 0; i <= data.length - 1; i++) {
                            var li = $("<li></li>")
                                .html("<span class=\"ellipsis\" style=\"display: block;\">" + data[i].PHRASENAME + "</span>")
                                .attr("class", "list-group-item");

                            li.attr("id", "SystemPhrases" + "_item_" + i);
                            li.attr("style", "cursor: pointer");
                            li.attr("rel-value", data[i].PHRASENAME);
                            li.attr("title", data[i].PHRASENAME);

                            li.click(function () {
                                //Selected(this.id);
                                if (_active != null) {
                                    $("#" + _active.attr("id")).html("<span class='ellipsis' style='display: block;' title='" + $("#" + _active.attr("id")).attr("rel-value") + "'>" + $("#" + _active.attr("id")).attr("rel-value") + "</span>");

                                    _active.attr("class", "list-group-item");
                                }

                                _active = $("#" + this.id);
                                $("#" + _active.attr("id")).html("<span class='ellipsis' style='display: block;' title='" + $("#" + _active.attr("id")).attr("rel-value") + "'>" + $("#" + _active.attr("id")).attr("rel-value") + "</span><span class='glyphicon glyphicon-ok' aria-hidden='true'></span>");
                                _active.attr("class", "list-group-item seleted");
                            });
                            ul.append(li);
                        }
                        //li disabled
                        for (idx = i; idx < 5; idx++) {
                            li = $("<li></li>").html("&nbsp;");
                            li.attr("class", "list-group-item disabled");
                            ul.append(li);
                        }

                        //footer-pager
                        var totalrecords = parseInt(data[0].TOTAL_COUNT);
                        var totalpages = 0;
                        if (totalrecords % 5 > 0)
                            totalpages = ((totalrecords - (totalrecords % 5)) / 5) + 1;
                        else
                            totalpages = totalrecords / 5;

                        _total_pages = totalpages;

                        ul = $("#SysOpinions_pager").html("").attr("style", "white-space: nowrap");

                        li = $("<li></li>").html("<a aria-label=\"Previous\"><span class=\"glyphicon glyphicon-backward\" aria-hidden=\"true\"></span></a>")
                            .attr("style", "cursor: pointer");
                        ul.append(li);
                        li.click(function () {
                            //Pre5Pages();
                            if (_page_begin - 5 >= 1) {
                                _curr_page = _page_begin - 5;
                                _page_begin = _curr_page;
                                QueryPhraseData();
                            }
                        });

                        _page_end = _page_begin + 4;
                        if (_page_end > totalpages) _page_end = totalpages;

                        for (idx = _page_begin; idx <= _page_end; idx++) {
                            li = $("<li></li>").html("<a>" + idx + "</a>")
                                .attr("style", "cursor: pointer");
                            ul.append(li);

                            if (idx == _curr_page) {
                                li.attr("class", "active");
                            }
                            else {
                                li.click(function () {
                                    //GoToPage(parseInt(this.innerText));
                                    _curr_page = parseInt(this.innerText);
                                    QueryPhraseData();
                                });
                            }
                        }

                        li = $("<li></li>").html("<a aria-label=\"Next\"><span class=\"glyphicon glyphicon-forward\" aria-hidden=\"true\"></span></a>")
                            .attr("style", "cursor: pointer");
                        ul.append(li);
                        li.click(function () {
                            //Next5Pages();
                            if (_page_begin + 5 <= _total_pages) {
                                _curr_page = _page_begin + 5;
                                _page_begin = _curr_page;
                                QueryPhraseData();
                            }
                        });

                        if (totalpages == 1)
                            ul.attr("style", "display: none");
                        else
                            ul.attr("style", "");
                    }
                }
            });
        }
        function QueryMyPhraseData() {

            _active = null;

            var _random = Math.random();

            $.ajax({
                type: 'GET',
                url: '/FDService/getMyPhraseByPage.aspx',                   //web service的URI
                data: 'logon=' + _cur_logon + '&page=' + _curr_page2 + '&random=' + _random,  //參數,JSON字串型態
                beforeSend: function () {
                    $.blockUI({ message: '<div style="font-size: 16px"><br /><img src="' + loadingImage + '" style="width: 26px" />&nbsp;' + LoadingMsg + '<br /><br /></div>' });
                },
                complete: function () {
                    $.unblockUI();
                },
                error: function (xhr, textStatus, errorThrown) {
                    $.unblockUI();
                    alert('An error occurred! ' + errorThrown);
                },
                success: function (responseData, textStatus, jqXHR) {
                    $.unblockUI();

                    if (responseData != "") {

                        var data;
                        var string = responseData;
                        if (window.JSON != undefined) {
                            data = JSON.parse(string);
                        }
                        else {
                            data = eval("(" + string + ")");
                        }
                        $('#MyPhrases_result').html("");

                        var ul = $('#MyPhrases_result');
                        for (i = 0; i <= data.length - 1; i++) {
                            var li = $("<li></li>")
                                .html("<span class=\"ellipsis\" style=\"display: block;\">" + data[i].PHRASENAME + "</span>")
                                .attr("class", "list-group-item");

                            li.attr("id", "MyPhrases" + "_item_" + i);
                            li.attr("style", "cursor: pointer");
                            li.attr("rel-value", data[i].PHRASENAME);
                            li.attr("title", data[i].PHRASENAME);
                            li.attr("rel-sn", data[i].SN);

                            li.click(function () {
                                //Selected2(this.id);
                                if (_active != null) {
                                    if (_active.attr("id") == this.id) return false;
                                }

                                if (_active != null) {

                                    if ($("#txt" + _active.attr("id")).length == 0) {
                                        $("#" + _active.attr("id")).html("<span class='ellipsis' style='display: block;' title='" + $("#" + _active.attr("id")).attr("rel-value") + "'>" + $("#" + _active.attr("id")).attr("rel-value") + "</span>");
                                        _active.attr("class", "list-group-item");

                                        _active = $("#" + this.id);
                                        if (_active.attr("rel-sn") == "99999")
                                            $("#" + _active.attr("id")).html("<input id='txt" + _active.attr("id") + "' style='color: black; width: 280px;' type='text' value='' /><span class='glyphicon glyphicon-ok' aria-hidden='true'></span><span class='glyphicon glyphicon glyphicon-floppy-disk' aria-hidden='true' title='Save' onclick='javascript:SaveMyPhrase(\"" + this.id + "\");'></span>");
                                        else
                                            $("#" + _active.attr("id")).html("<input id='txt" + _active.attr("id") + "' style='color: black; width: 280px;' type='text' value='" + $("#" + _active.attr("id")).attr("rel-value") + "' /><span class='glyphicon glyphicon-ok' aria-hidden='true'></span><span class='glyphicon glyphicon-remove' aria-hidden='true' title='Delete' onclick='javascript:DeleteMyPhrase(\"" + this.id + "\");'></span>");
                                        _active.attr("class", "list-group-item seleted");
                                        return false;
                                    }

                                    if ($("#txt" + _active.attr("id")).val() != _active.attr("rel-value")) {
                                        var _random = Math.random();

                                        $.ajax({
                                            type: 'GET',
                                            url: '/FDService/updateMyPhrase.aspx',                   //web service的URI
                                            data: 'logon=' + _cur_logon + '&sn=' + _active.attr("rel-sn") + '&data=' + escape($("#txt" + _active.attr("id")).val()) + '&random=' + _random,  //參數,JSON字串型態
                                            beforeSend: function () {
                                                $.blockUI({ message: '<div style="font-size: 16px"><br /><img src="' + loadingImage + '" style="width: 26px" />&nbsp;' + LoadingMsg + '<br /><br /></div>' });
                                            },
                                            complete: function () {
                                                $.unblockUI();
                                            },
                                            error: function (xhr, textStatus, errorThrown) {
                                                $.unblockUI();
                                                alert('An error occurred! ' + errorThrown);
                                            },
                                            success: function (responseData, textStatus, jqXHR) {
                                                $.unblockUI();

                                                if (responseData == "OK") {
                                                    if ($("#txt" + _active.attr("id")).val() != "") _active.attr("rel-value", $("#txt" + _active.attr("id")).val());

                                                    $("#" + _active.attr("id")).html("<span class='ellipsis' style='display: block;'>" + $("#" + _active.attr("id")).attr("rel-value") + "</span>");
                                                    _active.attr("class", "list-group-item");

                                                    _active = $("#" + this.id);
                                                    if (_active.attr("rel-sn") == "99999")
                                                        $("#" + _active.attr("id")).html("<input id='txt" + _active.attr("id") + "' style='color: black; width: 280px;' type='text' value='' /><span class='glyphicon glyphicon-ok' aria-hidden='true'></span><span class='glyphicon glyphicon-floppy-disk' aria-hidden='true' title='Save' onclick=''></span>");
                                                    else
                                                        $("#" + _active.attr("id")).html("<input id='txt" + _active.attr("id") + "' style='color: black; width: 280px;' type='text' value='" + $("#" + _active.attr("id")).attr("rel-value") + "' /><span class='glyphicon glyphicon-ok' aria-hidden='true'></span><span class='glyphicon glyphicon-remove' aria-hidden='true' title='Delete' onclick='javascript:DeleteMyPhrase(\"" + this.id + "\");'></span>");
                                                    _active.attr("class", "list-group-item seleted");
                                                }
                                                else {
                                                    alert("Exception: " + responseData);
                                                }
                                            }
                                        });
                                    }
                                    else {
                                        $("#" + _active.attr("id")).html("<span class='ellipsis' style='display: block;'>" + $("#" + _active.attr("id")).attr("rel-value") + "</span>");
                                        _active.attr("class", "list-group-item");

                                        _active = $("#" + this.id);
                                        if (_active.attr("rel-sn") == "99999")
                                            $("#" + _active.attr("id")).html("<input id='txt" + _active.attr("id") + "' style='color: black; width: 280px;' type='text' value='' /><span class='glyphicon glyphicon-ok' aria-hidden='true'></span><span class='glyphicon glyphicon-floppy-disk' aria-hidden='true' title='Save' onclick='javascript:SaveMyPhrase(\"" + this.id + "\");'></span>");
                                        else
                                            $("#" + _active.attr("id")).html("<input id='txt" + _active.attr("id") + "' style='color: black; width: 280px;' type='text' value='" + $("#" + _active.attr("id")).attr("rel-value") + "' /><span class='glyphicon glyphicon-ok' aria-hidden='true'></span><span class='glyphicon glyphicon-remove' aria-hidden='true' title='Delete' onclick='javascript:DeleteMyPhrase(\"" + this.id + "\");'></span>");
                                        _active.attr("class", "list-group-item seleted");
                                    }
                                }
                                else {
                                    _active = $("#" + this.id);
                                    if (_active.attr("rel-sn") == "99999")
                                        $("#" + _active.attr("id")).html("<input id='txt" + _active.attr("id") + "' style='color: black; width: 280px;' type='text' value='' /><span class='glyphicon glyphicon-ok' aria-hidden='true'></span><span class='glyphicon glyphicon-floppy-disk' aria-hidden='true' title='Save' onclick='javascript:SaveMyPhrase(\"" + this.id + "\");'></span>");
                                    else
                                        $("#" + _active.attr("id")).html("<input id='txt" + _active.attr("id") + "' style='color: black; width: 280px;' type='text' value='" + $("#" + _active.attr("id")).attr("rel-value") + "' /><span class='glyphicon glyphicon-ok' aria-hidden='true'></span><span class='glyphicon glyphicon-remove' aria-hidden='true' title='Delete' onclick='javascript:DeleteMyPhrase(\"" + this.id + "\");'></span>");
                                    _active.attr("class", "list-group-item seleted");
                                }
                            });
                            ul.append(li);
                        }
                        //li disabled
                        for (idx = i; idx < 5; idx++) {
                            li = $("<li></li>").html("&nbsp;");
                            li.attr("class", "list-group-item disabled");
                            ul.append(li);
                        }

                        //footer-pager
                        var totalrecords = parseInt(data[0].TOTAL_COUNT);
                        var totalpages = 0;
                        if (totalrecords % 5 > 0)
                            totalpages = ((totalrecords - (totalrecords % 5)) / 5) + 1;
                        else
                            totalpages = totalrecords / 5;

                        _total_pages2 = totalpages;

                        ul = $("#MyPhrases_pager").html("").attr("style", "white-space: nowrap");

                        li = $("<li></li>").html("<a aria-label=\"Previous\"><span class=\"glyphicon glyphicon-backward\" aria-hidden=\"true\"></span></a>")
                            .attr("style", "cursor: pointer");
                        ul.append(li);
                        li.click(function () {
                            //Pre5Pages2();
                            if (_page_begin2 - 5 >= 1) {
                                _curr_page2 = _page_begin2 - 5;
                                _page_begin2 = _curr_page2;
                                QueryMyPhraseData();
                            }
                        });

                        _page_end2 = _page_begin2 + 4;
                        if (_page_end2 > totalpages) _page_end2 = totalpages;

                        for (idx = _page_begin2; idx <= _page_end2; idx++) {
                            li = $("<li></li>").html("<a>" + idx + "</a>")
                                .attr("style", "cursor: pointer");
                            ul.append(li);

                            if (idx == _curr_page2) {
                                li.attr("class", "active");
                            }
                            else {
                                li.click(function () {
                                    //GoToPage2(parseInt(this.innerText));
                                    _curr_page2 = parseInt(this.innerText);
                                    QueryMyPhraseData();
                                });
                            }
                        }

                        li = $("<li></li>").html("<a aria-label=\"Next\"><span class=\"glyphicon glyphicon-forward\" aria-hidden=\"true\"></span></a>")
                            .attr("style", "cursor: pointer");
                        ul.append(li);
                        li.click(function () {
                            //Next5Pages2();
                            if (_page_begin2 + 5 <= _total_pages2) {
                                _curr_page2 = _page_begin2 + 5;
                                _page_begin2 = _curr_page2;
                                QueryMyPhraseData();
                            }
                        });

                        if (totalpages == 1)
                            ul.attr("style", "display: none");
                        else
                            ul.attr("style", "");
                    }
                }
            });
        }
        function DeleteMyPhrase(item_id) {
            if (!(confirm(DeleteMyPhraseConfirm.replace("{0}", $("#" + item_id).attr("rel-value"))))) {
                return false;
            }

            var _random = Math.random();

            $.ajax({
                type: 'GET',
                url: '/FDService/deleteMyPhrase.aspx',                   //web service的URI
                data: 'logon=' + _cur_logon + '&sn=' + $("#" + item_id).attr("rel-sn") + '&random=' + _random,  //參數,JSON字串型態
                beforeSend: function () {
                    $.blockUI({ message: '<div style="font-size: 16px"><br /><img src="' + loadingImage + '" style="width: 26px" />&nbsp;' + LoadingMsg + '<br /><br /></div>' });
                },
                complete: function () {
                    $.unblockUI();
                },
                error: function (xhr, textStatus, errorThrown) {
                    $.unblockUI();
                    alert('An error occurred! ' + errorThrown);
                },
                success: function (responseData, textStatus, jqXHR) {
                    $.unblockUI();

                    if (responseData == "OK") {
                        QueryMyPhraseData();
                    }
                    else {
                        alert("Exception: " + responseData);
                    }
                }
            });
        }
        function SaveMyPhrase(item_id) {
            var _random = Math.random();

            $.ajax({
                type: 'GET',
                url: '/FDService/updateMyPhrase.aspx',                   //web service的URI
                data: 'logon=' + _cur_logon + '&sn=' + $("#" + item_id).attr("rel-sn") + '&data=' + escape($("#txt" + _active.attr("id")).val()) + '&random=' + _random,  //參數,JSON字串型態
                beforeSend: function () {
                    $.blockUI({ message: '<div style="font-size: 16px"><br /><img src="' + loadingImage + '" style="width: 26px" />&nbsp;' + LoadingMsg + '<br /><br /></div>' });
                },
                complete: function () {
                    $.unblockUI();
                },
                error: function (xhr, textStatus, errorThrown) {
                    $.unblockUI();
                    alert('An error occurred! ' + errorThrown);
                },
                success: function (responseData, textStatus, jqXHR) {
                    $.unblockUI();

                    if (responseData == "OK") {
                        QueryMyPhraseData();
                    }
                    else {
                        alert("Exception: " + responseData);
                    }
                }
            });
        }

        /* Attachments function */
        function ReloadAttachemtList() {

            var _random = Math.random();

            //
            $.ajax({
                type: 'GET',
                url: '/FDService/getAttachmentData.aspx',                   //web service的URI
                data: 'logon=' + _cur_logon + '&caseid=' + $("#SPM_CaseId").val() + '&taskid=' + $("#SPM_TaskId").val() + '&random=' + _random,  //參數,JSON字串型態
                beforeSend: function () {
                    $.blockUI({ message: '<div style="font-size: 16px"><br /><img src="' + loadingImage + '" style="width: 26px" />&nbsp;' + LoadingMsg + '<br /><br /></div>' });
                },
                complete: function () {
                    $.unblockUI();
                },
                error: function (xhr, textStatus, errorThrown) {
                    $.unblockUI();
                    alert('An error occurred! ' + errorThrown);
                },
                success: function (responseData, textStatus, jqXHR) {
                    $.unblockUI();

                    if (responseData != "") {
                        $(".lstAttachment tbody").html('');

                        var data;
                        var string = responseData;
                        if (window.JSON != undefined) {
                            data = JSON.parse(string);
                        }
                        else {
                            data = eval("(" + string + ")");
                        }
                        var tr = null;
                        var td = null;
                        var a = null;
                        var glyphicon = null;

                        if (data.length > 0) {
                            if (!data[0]['blAddFile']) {
                                $('#UploadAttachModal input[name=\"UploadMode\"]').attr('disabled', 'true');

                                $('#UploadAttachModal .ajax-file-upload').addClass('hidden');
                                $('#UploadAttachModal input.txtLinkFilename').attr('disabled', 'true');
                                $('#UploadAttachModal input.btnAddLinkFile').addClass('hidden');
                            }
                        }
                        var hasData = false;
                        for (var field in data[0]) {
                            if (field == 'FileNameCaption') hasData = true;
                        }
                        if (!hasData) return;

                        for (i = 0; i <= data.length - 1; i++) {
                            tr = $('<tr></tr>');
                            $(".lstAttachment tbody").append(tr);
                            td = $('<td></td>');
                            glyphicon = $('<span></span>')
                                        .attr('class', 'glyphicon glyphicon-trash')
                                        .attr('cursor', 'pointer')
                                        .attr('aria-hidden', 'true')
                                        .attr('title', 'Remove')
                                        .attr('onclick', 'DeleteAttach(' + data[i]['SN'] + ',\"' + data[i]['FileNameCaption'] + '\");');
                            if (!data[i]['blDelFile']) glyphicon.addClass('hidden');
                            td.append(glyphicon);
                            tr.append(td);
                            td = $('<td></td>');
                            if (data[i]['blReadFile'])
                                a = $('<a></a>')
                                        .html('<u>' + data[i]['FileNameCaption'] + '</u>')
                                        .attr('style', 'cursor: pointer;')
                                        .attr('onclick', 'OpenAttach(\"' + data[i]['FileUrl'] + '\");');
                            else
                                a = $('<span></span>')
                                        .html(data[i]['FileNameCaption']);
                            td.append(a);
                            tr.append(td);
                            td = $('<td></td>')
                                    .html(data[i]['FileSizeCaption']);
                            tr.append(td);
                            td = $('<td></td>')
                                    .html(data[i]['OwnerCaption']);
                            tr.append(td);
                            td = $('<td></td>')
                                    .html(data[i]['DatetimeCaption']);
                            tr.append(td);
                        }
                    }
                }
            });
        }
        function OpenAttach(url) {
            switch ($("#SPM_DownloadMode").val()) {
                case "Download":
                    OpenMode_DownLoad(url);
                    break;
                case "Browser":
                    OpenMode_Browser(url);
                    break;
            }
        }
        function DeleteAttach(sn, file) {

            if (!(confirm(DeleteAttachmentConfirm.replace("{0}", file)))) {
                return false;
            }

            var _random = Math.random();

            //
            $.ajax({
                type: 'GET',
                url: '/FDService/removeAttachment.aspx',                   //web service的URI
                data: 'logon=' + _cur_logon + '&caseid=' + $("#SPM_CaseId").val() + '&sn=' + sn + '&file=' + escape(file) + '&random=' + _random,  //參數,JSON字串型態
                beforeSend: function () {
                    $.blockUI({ message: '<div style="font-size: 16px"><br /><img src="' + loadingImage + '" style="width: 26px" />&nbsp;' + LoadingMsg + '<br /><br /></div>' });
                },
                complete: function () {
                    $.unblockUI();
                },
                error: function (xhr, textStatus, errorThrown) {
                    $.unblockUI();
                    alert('An error occurred! ' + errorThrown);
                },
                success: function (responseData, textStatus, jqXHR) {
                    $.unblockUI();

                    if (responseData == "OK") {
                        ReloadAttachemtList();
                    }
                    else {
                        alert(responseData);
                    }
                }
            });
        }
        function ShowAttachmentList() {

            var _random = Math.random();

            //
            $.ajax({
                type: 'GET',
                url: '/FDService/getAttachmentList.aspx',                   //web service的URI
                data: 'logon=' + _cur_logon + '&caseid=' + $("#SPM_CaseId").val() + '&taskid=' + $("#SPM_TaskId").val() + '&random=' + _random,  //參數,JSON字串型態
                beforeSend: function () {
                    $.blockUI({ message: '<div style="font-size: 16px"><br /><img src="' + loadingImage + '" style="width: 26px" />&nbsp;' + LoadingMsg + '<br /><br /></div>' });
                },
                complete: function () {
                    $.unblockUI();
                },
                error: function (xhr, textStatus, errorThrown) {
                    $.unblockUI();
                    alert('An error occurred! ' + errorThrown);
                },
                success: function (responseData, textStatus, jqXHR) {
                    $.unblockUI();

                    $(".lblAttachList").html(responseData);
                }
            });
        }

        /* Cc function */
        function ShowCcSelectedList() {
            var ary = $('.SPM_txtCC').val().split(';');

            $('#divCc').html('');
            var table = $('<table></table>');
            $('#divCc').append(table);
            var span = null;
            var button = null;
            var u = null;
            var tr = null;
            var td = null;
            var cnt = 0;
            for (idx = 0; idx <= ary.length - 1; idx++) {
                if (ary[idx] != '') {
                    cnt += 1;
                    if (cnt % 2 == 1) {
                        tr = $('<tr></tr>');
                        table.append(tr);
                    }
                    td = $('<td></td>').attr('style', 'width:50%');
                    tr.append(td);
                    var param = ary[idx].split(',');

                    span = $('<span></span>').attr('style', 'display: inline-block');
                    button = $('<span class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\" title=\"Remove\" style=\"color:darkred; cursor: pointer;\"></span>')
                                .attr('rel-value1', param[0] + '_' + param[1])
                                .attr('rel-value2', ary[idx])
                    button.click(function () {
                        var oSelector = $("button[rel-id=\'btnAdd_" + $(this).attr('rel-value1') + "\']");
                        if (oSelector.length == 1) $(oSelector[0]).attr("style", "display: block");

                        if ((';' + $('.SPM_txtCC').val() + ';').indexOf(';' + $(this).attr('rel-value2') + ';') >= 0) {
                            var value_new = (';' + $('.SPM_txtCC').val() + ';').replace(';' + $(this).attr('rel-value2') + ';', ';');
                            value_new = value_new.replace(';;', ';');
                            if (value_new == ';') value_new = '';
                            if (value_new != '') value_new = value_new.substring(1, value_new.length - 1);
                            $('.SPM_txtCC').val(value_new);

                            ShowCcSelectedList();
                        }
                    });
                    u = $('<span></span>')
                        .attr('class', 'ellipsis')
                        .attr('style', 'width: 200px; display: inline-block')
                        .attr('title', param[2])
                        .html(param[2]);
                    span.append(button);
                    span.append($('<span></span>').html('&nbsp;'));
                    span.append(u);
                    td.append(span);
                }
            }
            if ($('.SPM_txtCC').val() == '') $('#divCc').html('(none)');
        }

        var objEvent = null;

        /* ChangeHandler function */
        function ShowChangeHandlerSelectedList() {
            var ary = $('.ReturnValue').val().split(';');

            $('#divSelected').html('');
            var table = $('<table></table>').attr('style', 'width:95%');
            $('#divSelected').append(table);
            var span = null;
            var button = null;
            var button2 = null;
            var u = null;
            var tr = null;
            var td = null;
            var cnt = 0;
            for (idx = 0; idx <= ary.length - 1; idx++) {
                if (ary[idx] != '') {
                    tr = $('<tr></tr>');
                    table.append(tr);
                    td = $('<td></td>');
                    tr.append(td);
                    var param = ary[idx].split(',');

                    span = $('<span></span>').attr('style', 'display: inline-block');
                    button = $('<span class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\" title=\"Remove\" style=\"color:darkred; cursor: pointer;\"></span>')
                                .attr('rel-value1', param[0] + '_' + param[1])
                                .attr('rel-value2', ary[idx])
                    button.click(function () {
                        var oSelector = $("button[rel-id=\'btnAdd_" + $(this).attr('rel-value1') + "\']");
                        if (oSelector.length == 1) $(oSelector[0]).attr("style", "display: block");

                        if ((';' + $('.ReturnValue').val() + ';').indexOf(';' + $(this).attr('rel-value2') + ';') >= 0) {
                            var value_new = (';' + $('.ReturnValue').val() + ';').replace(';' + $(this).attr('rel-value2') + ';', ';');
                            value_new = value_new.replace(';;', ';');
                            if (value_new == ';') value_new = '';
                            if (value_new != '') value_new = value_new.substring(1, value_new.length - 1);
                            $('.ReturnValue').val(value_new);

                            ShowChangeHandlerSelectedList();
                        }
                    });
                    u = $('<span></span>')
                        .attr('class', 'ellipsis')
                        .attr('style', 'width: 200px; display: inline-block')
                        .attr('title', param[2])
                        .html(param[2]);
                    span.append(button);
                    span.append($('<span></span>').html('&nbsp;'));
                    span.append(u);
                    td.append(span);

                    td = $('<td></td>').attr('style', 'text-align: right;');
                    tr.append(td);
                    span = $('<span></span>').attr('style', 'display: inline-block');
                    button = $('<span class=\"glyphicon glyphicon-arrow-up\" aria-hidden=\"true\" title=\"Move Up\" style=\"color:darkblue; cursor: pointer;\"></span>');
                    button.click(function () {
                        objEvent = $(this);
                        t1 = setTimeout("ConferMove('MoveUp')", 0);
                    });

                    span.append(button);
                    td.append(span);

                    td = $('<td></td>').attr('style', 'text-align: right;');
                    tr.append(td);
                    span = $('<span></span>').attr('style', 'display: inline-block');
                    button2 = $('<span class=\"glyphicon glyphicon-arrow-down\" aria-hidden=\"true\" title=\"Move Down\" style=\"color:darkblue; cursor: pointer;\"></span>');
                    button2.click(function () {
                        objEvent = $(this);
                        t1 = setTimeout("ConferMove('MoveDown')", 0);
                    });
                    span.append(button2);
                    td.append(span);

                    switch ($('#SelectChangeHandlerModal .changeAction').val()) {
                        case 'CONFER':
                            break;
                        default:
                            button.addClass('hidden');
                            button2.addClass('hidden');
                            break;
                    }
                }
            }
            if ($('.ReturnValue').val() == '') $('#divSelected').html('(none)');

            switch ($('.txtRecever').attr('rel-nextto')) {
                case 'defaultNextTo':
                    if (defaultNextHandler2 != '') {

                        var tempStepSn = $('#SelectChangeHandlerModal .cboSteps').val();

                        var aryStepSn = defaultNextStepSn.split(';');
                        var aryStepName = defaultNextStepName.split(';');
                        var aryHandler = defaultNextHandler.split(';')
                        var aryHandler2 = defaultNextHandler2.split(';')

                        var ret1 = '';
                        var ret2 = '';

                        var new_Handler = '';
                        var old_Handler = ''
                        var old_Handler2 = ''

                        for (var idx = 0; idx <= aryStepSn.length - 1; idx++) {
                            if (aryStepSn[idx] == tempStepSn) {
                                ret1 = '';
                                ret2 = '';

                                for (idx2 = 0; idx2 <= ary.length - 1; idx2++) {

                                    param = ary[idx2].split(',');

                                    ret1 += (ret1 == '' ? '' : ',');
                                    ret1 += param[1];

                                    ret2 += (ret2 == '' ? '' : ',');
                                    ret2 += param[2];
                                }
                                ret1 = tempStepSn + '(' + ret1 + ')';
                                new_Handler = aryStepName[idx] + '(' + ret2 + ')';
                                new_Handler2 = ret2;

                                aryHandler[idx] = ret1;

                                old_Handler = aryStepName[idx] + '(' + aryHandler2[idx] + ')';
                                old_Handler2 = aryHandler2[idx];
                            }
                        }
                        ret1 = '';
                        for (var idx = 0; idx <= aryHandler.length - 1; idx++) {
                            ret1 += (ret1 == '' ? '' : ';');
                            ret1 += aryHandler[idx];
                        }
                        defaultNextHandler = ret1.replace(old_Handler, new_Handler);
                        defaultNextHandler2 = defaultNextHandler2.replace(old_Handler2, new_Handler2);

                        $('#SelectChangeHandlerModal .defaultNextHandler').val(defaultNextHandler);
                    }
                    break;
            }
        }

        function ConferMove(action) {
            if (objEvent == null) return;
            var currentTR = $(objEvent).parent().parent().parent().clone();

            var param = $('#SelectChangeHandlerModal .ReturnValue').val().split(';');
            var currentValue = '';
            var tempValue = '';

            var oTR = $('#divSelected').find('tr');
            for (var idx = 0; idx <= oTR.length - 1; idx++) {
                if ($(oTR[idx]).html() == $(currentTR).html()) {
                    switch (action) {
                        case 'MoveUp':
                            if (idx != 0) {
                                tempValue = param[idx - 1];
                                param[idx - 1] = param[idx];
                                param[idx] = tempValue;

                                $(oTR[idx]).remove();
                                currentTR.insertBefore($(oTR[idx - 1]));

                                idx = oTR.length - 1;
                            }
                            break;

                        case 'MoveDown':
                            if (idx != oTR.length - 1) {
                                tempValue = param[idx + 1];
                                param[idx + 1] = param[idx];
                                param[idx] = tempValue;

                                $(oTR[idx]).remove();
                                currentTR.insertAfter($(oTR[idx + 1]));

                                idx = oTR.length - 1;
                            }
                            break;
                    }
                }
            }

            tempValue = '';
            for (var idx = 0; idx <= param.length - 1; idx++) {
                if (param[idx] != '') {
                    tempValue += (tempValue != '' ? ';' : '');
                    tempValue += param[idx];
                }
            }
            $('#SelectChangeHandlerModal .ReturnValue').val(tempValue);

            $(currentTR).find('.glyphicon-arrow-up').click(function () {
                objEvent = $(this);
                t1 = setTimeout("ConferMove('MoveUp')", 0);
            });
            $(currentTR).find('.glyphicon-arrow-down').click(function () {
                objEvent = $(this);
                t1 = setTimeout("ConferMove('MoveDown')", 0);
            });
            objEvent = null;
        }

        /* query Personnel, Department, Group function */
        function QueryPersonnelData(modalSource, keyValue, returnControl, callback) {

            _active = null;

            var _random = Math.random();

            $.ajax({
                type: 'GET',
                url: '/FDService/queryPersonnelByPage.aspx',                   //web service的URI
                data: 'logon=' + _cur_logon + '&page=' + _curr_page + '&filter=' + escape(keyValue) + '&random=' + _random,  //參數,JSON字串型態
                beforeSend: function () {
                    $.blockUI({ message: '<div style="font-size: 16px"><br /><img src="' + loadingImage + '" style="width: 26px" />&nbsp;' + LoadingMsg + '<br /><br /></div>' });
                },
                complete: function () {
                    $.unblockUI();
                },
                error: function (xhr, textStatus, errorThrown) {
                    $.unblockUI();
                    alert('An error occurred! ' + errorThrown);
                },
                success: function (responseData, textStatus, jqXHR) {
                    $.unblockUI();

                    if (responseData != "") {

                        var data;
                        var string = responseData;
                        if (window.JSON != undefined) {
                            data = JSON.parse(string);
                        }
                        else {
                            data = eval("(" + string + ")");
                        }

                        $(modalSource + ' ul.list-group').html('');

                        var ul = $(modalSource + ' ul.list-group');
                        var span = null;
                        var button = null;
                        for (i = 0; i <= data.length - 1; i++) {
                            var li = $("<li></li>")
                                .attr("class", "list-group-item");

                            li.attr("id", "Result_item_" + i);
                            li.attr("style", "cursor: pointer");
                            li.attr("rel-value", data[i].USERNAME);
                            li.attr("rel-id", data[i].USERID);
                            li.attr("title", data[i].USERNAME + ' (' + data[i].LOGONID + ')');

                            span = $('<span></span>').html(data[i].USERNAME);
                            li.append(span);

                            button = $('<button></button>')
                                .html('<span class=\"glyphicon glyphicon-plus\" aria-hidden=\"true\"></span>')
                                .attr('type', 'button')
                                .attr('rel-value', 'U,' + data[i].USERID + ',' + data[i].USERNAME + '(' + data[i].LOGONID + ')')
                                .attr('rel-id', 'btnAdd_U_' + data[i].USERID)
                                .attr('class', 'btn btn-primary');
                            li.append(button);

                            button.click(function () {
                                var returnValue = returnControl.val();
                                returnValue += (returnValue == '' ? '' : ';')
                                returnValue += $(this).attr('rel-value');
                                returnControl.val(returnValue);

                                $(this).attr('style', 'display: none;');

                                callback();
                            });

                            if ((';' + returnControl.val() + ';').indexOf(';U,' + data[i].USERID + ',' + data[i].USERNAME + '(' + data[i].LOGONID + ')' + ';') >= 0) {
                                button.attr('style', 'display: none;');
                            }

                            ul.append(li);
                        }
                        //li disabled
                        for (idx = i; idx < 5; idx++) {
                            li = $("<li></li>").html("&nbsp;");
                            li.attr("class", "list-group-item disabled");
                            ul.append(li);
                        }

                        //footer-pager
                        var totalrecords = parseInt(data[0].TOTAL_COUNT);
                        var totalpages = 0;
                        if (totalrecords % 5 > 0)
                            totalpages = ((totalrecords - (totalrecords % 5)) / 5) + 1;
                        else
                            totalpages = totalrecords / 5;

                        _total_pages = totalpages;

                        ul = $(modalSource + " .pagination").html("").attr("style", "white-space: nowrap");

                        li = $("<li></li>").html("<a aria-label=\"Previous\"><span class=\"glyphicon glyphicon-backward\" aria-hidden=\"true\"></span></a>")
                            .attr("style", "cursor: pointer");
                        ul.append(li);
                        li.click(function () {
                            //Pre5Pages();
                            if (_page_begin - 5 >= 1) {
                                _curr_page = _page_begin - 5;
                                _page_begin = _curr_page;
                                QueryPersonnelData(modalSource, keyValue, returnControl, callback);
                            }
                        });

                        _page_end = _page_begin + 4;
                        if (_page_end > totalpages) _page_end = totalpages;

                        for (idx = _page_begin; idx <= _page_end; idx++) {
                            li = $("<li></li>").html("<a>" + idx + "</a>")
                                .attr("style", "cursor: pointer");
                            ul.append(li);

                            if (idx == _curr_page) {
                                li.attr("class", "active");
                            }
                            else {
                                li.click(function () {
                                    //GoToPage(parseInt(this.innerText));
                                    _curr_page = parseInt(this.innerText);
                                    QueryPersonnelData(modalSource, keyValue, returnControl, callback);
                                });
                            }
                        }

                        li = $("<li></li>").html("<a aria-label=\"Next\"><span class=\"glyphicon glyphicon-forward\" aria-hidden=\"true\"></span></a>")
                            .attr("style", "cursor: pointer");
                        ul.append(li);
                        li.click(function () {
                            //Next5Pages();
                            if (_page_begin + 5 <= _total_pages) {
                                _curr_page = _page_begin + 5;
                                _page_begin = _curr_page;
                                QueryPersonnelData(modalSource, keyValue, returnControl, callback);
                            }
                        });

                        if (totalpages == 1)
                            ul.attr("style", "display: none");
                        else
                            ul.attr("style", "");
                    }
                }
            });
        }
        function QueryDepartmentData(modalSource, keyValue, returnControl, callback) {

            _active = null;

            var _random = Math.random();

            $.ajax({
                type: 'GET',
                url: '/FDService/queryDepartmentByPage.aspx',                   //web service的URI
                data: 'logon=' + _cur_logon + '&page=' + _curr_page + '&filter=' + escape(keyValue) + '&random=' + _random,  //參數,JSON字串型態
                beforeSend: function () {
                    $.blockUI({ message: '<div style="font-size: 16px"><br /><img src="' + loadingImage + '" style="width: 26px" />&nbsp;' + LoadingMsg + '<br /><br /></div>' });
                },
                complete: function () {
                    $.unblockUI();
                },
                error: function (xhr, textStatus, errorThrown) {
                    $.unblockUI();
                    alert('An error occurred! ' + errorThrown);
                },
                success: function (responseData, textStatus, jqXHR) {
                    $.unblockUI();

                    if (responseData != "") {

                        var data;
                        var string = responseData;
                        if (window.JSON != undefined) {
                            data = JSON.parse(string);
                        }
                        else {
                            data = eval("(" + string + ")");
                        }

                        $(modalSource + ' ul.list-group').html('');

                        var ul = $(modalSource + ' ul.list-group');
                        var span = null;
                        var button = null;
                        for (i = 0; i <= data.length - 1; i++) {
                            var li = $("<li></li>")
                                .attr("class", "list-group-item");

                            li.attr("id", "Result_item_" + i);
                            li.attr("style", "cursor: pointer");
                            li.attr("rel-value", data[i].DEPTNAME);
                            li.attr("rel-id", data[i].DEPTID);
                            li.attr("title", data[i].DEPTNAME + (data[i].DEPTNO == '' ? '' : ' (' + data[i].DEPTNO + ')'));

                            span = $('<span></span>').html(data[i].DEPTNAME);
                            li.append(span);

                            button = $('<button></button>')
                                .html('<span class=\"glyphicon glyphicon-plus\" aria-hidden=\"true\"></span>')
                                .attr('type', 'button')
                                .attr('rel-value', 'D,' + data[i].DEPTID + ',' + data[i].DEPTNAME + (data[i].DEPTNO == '' ? '' : ' (' + data[i].DEPTNO + ')'))
                                .attr('rel-id', 'btnAdd_D_' + data[i].DEPTID)
                                .attr('class', 'btn btn-primary');
                            li.append(button);

                            button.click(function () {
                                var returnValue = returnControl.val();
                                returnValue += (returnValue == '' ? '' : ';')
                                returnValue += $(this).attr('rel-value');
                                returnControl.val(returnValue);

                                $(this).attr('style', 'display: none;');

                                callback();
                            });

                            if ((';' + returnControl.val() + ';').indexOf(';D,' + data[i].DEPTID + ',' + data[i].DEPTNAME + (data[i].DEPTNO == '' ? '' : ' (' + data[i].DEPTNO + ')') + ';') >= 0) {
                                button.attr('style', 'display: none;');
                            }

                            ul.append(li);
                        }
                        //li disabled
                        for (idx = i; idx < 5; idx++) {
                            li = $("<li></li>").html("&nbsp;");
                            li.attr("class", "list-group-item disabled");
                            ul.append(li);
                        }

                        //footer-pager
                        var totalrecords = parseInt(data[0].TOTAL_COUNT);
                        var totalpages = 0;
                        if (totalrecords % 5 > 0)
                            totalpages = ((totalrecords - (totalrecords % 5)) / 5) + 1;
                        else
                            totalpages = totalrecords / 5;

                        _total_pages = totalpages;

                        ul = $(modalSource + " .pagination").html("").attr("style", "white-space: nowrap");

                        li = $("<li></li>").html("<a aria-label=\"Previous\"><span class=\"glyphicon glyphicon-backward\" aria-hidden=\"true\"></span></a>")
                            .attr("style", "cursor: pointer");
                        ul.append(li);
                        li.click(function () {
                            //Pre5Pages();
                            if (_page_begin - 5 >= 1) {
                                _curr_page = _page_begin - 5;
                                _page_begin = _curr_page;
                                QueryDepartmentData(modalSource, keyValue, returnControl, callback);
                            }
                        });

                        _page_end = _page_begin + 4;
                        if (_page_end > totalpages) _page_end = totalpages;

                        for (idx = _page_begin; idx <= _page_end; idx++) {
                            li = $("<li></li>").html("<a>" + idx + "</a>")
                                .attr("style", "cursor: pointer");
                            ul.append(li);

                            if (idx == _curr_page) {
                                li.attr("class", "active");
                            }
                            else {
                                li.click(function () {
                                    //GoToPage(parseInt(this.innerText));
                                    _curr_page = parseInt(this.innerText);
                                    QueryDepartmentData(modalSource, keyValue, returnControl, callback);
                                });
                            }
                        }

                        li = $("<li></li>").html("<a aria-label=\"Next\"><span class=\"glyphicon glyphicon-forward\" aria-hidden=\"true\"></span></a>")
                            .attr("style", "cursor: pointer");
                        ul.append(li);
                        li.click(function () {
                            //Next5Pages();
                            if (_page_begin + 5 <= _total_pages) {
                                _curr_page = _page_begin + 5;
                                _page_begin = _curr_page;
                                QueryDepartmentData(modalSource, keyValue, returnControl, callback);
                            }
                        });

                        if (totalpages == 1)
                            ul.attr("style", "display: none");
                        else
                            ul.attr("style", "");
                    }
                }
            });
        }
        function QueryGroupData(modalSource, keyValue, returnControl, callback) {

            _active = null;

            var _random = Math.random();

            $.ajax({
                type: 'GET',
                url: '/FDService/queryGroupByPage.aspx',                   //web service的URI
                data: 'logon=' + _cur_logon + '&page=' + _curr_page + '&filter=' + escape(keyValue) + '&random=' + _random,  //參數,JSON字串型態
                beforeSend: function () {
                    $.blockUI({ message: '<div style="font-size: 16px"><br /><img src="' + loadingImage + '" style="width: 26px" />&nbsp;' + LoadingMsg + '<br /><br /></div>' });
                },
                complete: function () {
                    $.unblockUI();
                },
                error: function (xhr, textStatus, errorThrown) {
                    $.unblockUI();
                    alert('An error occurred! ' + errorThrown);
                },
                success: function (responseData, textStatus, jqXHR) {
                    $.unblockUI();

                    if (responseData != "") {

                        var data;
                        var string = responseData;
                        if (window.JSON != undefined) {
                            data = JSON.parse(string);
                        }
                        else {
                            data = eval("(" + string + ")");
                        }

                        $(modalSource + ' ul.list-group').html('');

                        var ul = $(modalSource + ' ul.list-group');
                        var span = null;
                        var button = null;
                        for (i = 0; i <= data.length - 1; i++) {
                            var li = $("<li></li>")
                                .attr("class", "list-group-item");

                            li.attr("id", "Result_item_" + i);
                            li.attr("style", "cursor: pointer");
                            li.attr("rel-value", data[i].GROUPNAME);
                            li.attr("rel-id", data[i].GROUPID);
                            li.attr("title", data[i].GROUPNAME);

                            span = $('<span></span>').html(data[i].GROUPNAME);
                            li.append(span);

                            button = $('<button></button>')
                                .html('<span class=\"glyphicon glyphicon-plus\" aria-hidden=\"true\"></span>')
                                .attr('type', 'button')
                                .attr('rel-value', 'G,' + data[i].GROUPID + ',' + data[i].GROUPNAME)
                                .attr('rel-id', 'btnAdd_G_' + data[i].GROUPID)
                                .attr('class', 'btn btn-primary');
                            li.append(button);

                            button.click(function () {
                                var returnValue = returnControl.val();
                                returnValue += (returnValue == '' ? '' : ';')
                                returnValue += $(this).attr('rel-value');
                                returnControl.val(returnValue);

                                $(this).attr('style', 'display: none;');

                                callback();
                            });

                            if ((';' + returnControl.val() + ';').indexOf(';G,' + data[i].GROUPID + ',' + data[i].GROUPNAME + ';') >= 0) {
                                button.attr('style', 'display: none;');
                            }

                            ul.append(li);
                        }
                        //li disabled
                        for (idx = i; idx < 5; idx++) {
                            li = $("<li></li>").html("&nbsp;");
                            li.attr("class", "list-group-item disabled");
                            ul.append(li);
                        }

                        //footer-pager
                        var totalrecords = parseInt(data[0].TOTAL_COUNT);
                        var totalpages = 0;
                        if (totalrecords % 5 > 0)
                            totalpages = ((totalrecords - (totalrecords % 5)) / 5) + 1;
                        else
                            totalpages = totalrecords / 5;

                        _total_pages = totalpages;

                        ul = $(modalSource + " .pagination").html("").attr("style", "white-space: nowrap");

                        li = $("<li></li>").html("<a aria-label=\"Previous\"><span class=\"glyphicon glyphicon-backward\" aria-hidden=\"true\"></span></a>")
                            .attr("style", "cursor: pointer");
                        ul.append(li);
                        li.click(function () {
                            //Pre5Pages();
                            if (_page_begin - 5 >= 1) {
                                _curr_page = _page_begin - 5;
                                _page_begin = _curr_page;
                                QueryGroupData(modalSource, keyValue, returnControl, callback);
                            }
                        });

                        _page_end = _page_begin + 4;
                        if (_page_end > totalpages) _page_end = totalpages;

                        for (idx = _page_begin; idx <= _page_end; idx++) {
                            li = $("<li></li>").html("<a>" + idx + "</a>")
                                .attr("style", "cursor: pointer");
                            ul.append(li);

                            if (idx == _curr_page) {
                                li.attr("class", "active");
                            }
                            else {
                                li.click(function () {
                                    //GoToPage(parseInt(this.innerText));
                                    _curr_page = parseInt(this.innerText);
                                    QueryGroupData(modalSource, keyValue, returnControl, callback);
                                });
                            }
                        }

                        li = $("<li></li>").html("<a aria-label=\"Next\"><span class=\"glyphicon glyphicon-forward\" aria-hidden=\"true\"></span></a>")
                            .attr("style", "cursor: pointer");
                        ul.append(li);
                        li.click(function () {
                            //Next5Pages();
                            if (_page_begin + 5 <= _total_pages) {
                                _curr_page = _page_begin + 5;
                                _page_begin = _curr_page;
                                QueryGroupData(modalSource, keyValue, returnControl, callback);
                            }
                        });

                        if (totalpages == 1)
                            ul.attr("style", "display: none");
                        else
                            ul.attr("style", "");
                    }
                }
            });
        }

    </script>

    <script>
        loadingImage = "/BPM_TaskPane/images/ajax-loader.gif";
        DeleteMyPhraseConfirm = "是否刪除 \"{0}\" 片語項目 ?";
    </script>


<script>

    var LoadingMsg = '載入中, 請稍後...';

    var logon = 'xaEj FIBdFI~eq~';

    var Sys_UserID = '17';
    var Sys_LogonID = '0007';
    var Sys_UserName = '徐佳馨';

    var lang = 'tw';

    PrintCaption = "列印...";
    PrintOption1 = "表單內容";
    PrintOption2 = "表單內容(含簽核意見)";

    function SPM_onload() {

        return true;
    }

</script>


    <script language=javascript>if (document.getElementById('Mode').value == '') { document.getElementById('Mode').value=''; } </script><script language=javascript> strScript = ""; strEdit = ";;"; try { ResetFormReg(); } catch (e) {}</script>

    <script>
        var MyGrid_SN = 0;

        var MyGrids = "739485";

        var xmlMyGrids = null;

        var DataSources = "";

        var lang = "tw";

        var FormValidate = null;

        function InitFormValidate() {
            FormValidate = null;
        }

        var MyGridValidates = null;

        function InitMyGridValidates() {
            MyGridValidates = [
{ "id": "739485", "validate": null }
]
        }

        var MyGridItemLoads = null;

        function InitMyGridItemLoads() {
            MyGridItemLoads = [
{ "id": "739485", "itemload": null }
]
        }

        var dialogCallbackScripts = null;

        function InitCallbackScripts() {
            dialogCallbackScripts = []
        }

        function DrawGrid() {
            if (MyGrids == '') return;

            var rowid = MyGrids.split(',')[0];

            var _random = Math.random();
            $.ajax({
                type: 'GET',
                url: '/FDService/getGridDataSource.aspx',                   //web service的URI
                data: 'guid=d91c39cb-1da2-44bf-889b-1995180c039a&id=' + rowid + '&caseid=54503&taskid=' + $('#taskpane #SPM_TaskId').val() + '&lang=' + lang + '&random=' + _random,  //參數,JSON字串型態
                beforeSend: function () {
                    $.blockUI({ message: '<div style="font-size: 16px"><br /><img src="/FormDesigner/images/ajax-loader.gif" style="width: 26px" />&nbsp;' + LoadingMsg + '<br /><br /></div>' });
                },
                complete: function () {
                    $.unblockUI();
                },
                error: function (xhr, textStatus, errorThrown) {
                    $.unblockUI();
                    alert('An error occurred! ' + errorThrown);
                },
                success: function (responseData, textStatus, jqXHR) {
                    $.unblockUI();

                    MyGrids = ('|' + MyGrids.replace(/\,/g, '||') + '|').replace('|' + rowid + '|', '');
                    MyGrids = MyGrids.replace(/\|\|/g, ',').replace(/\|/g, '');

                    MyGrid_SN += 1;

                    var gridName = 'MyGrid' + MyGrid_SN.toString();
                    var bEditabled = true;
                    var bVisiable = true;
                    if ($('#SPM_HandleType').val() == "3") { bEditabled = false; }

                    if (bEditabled) {
                        if (($('#strEdit').val().indexOf(';' + gridName + ';') < 0) && ($('#strEdit').val().indexOf(';' + gridName.toUpperCase() + ';') < 0))
                            bEditabled = false;
                        else
                            bEditabled = true;
                    }
                    if (bVisiable) {
                        if (($('#strHide').val().indexOf(';' + gridName + ';') < 0) && ($('#strHide').val().indexOf(';' + gridName.toUpperCase() + ';') < 0))
                            bVisiable = true;
                        else
                            bVisiable = false;
                    }

                    if (responseData != "") {
                        string = responseData;

                        var ds = null;
                        if (window.JSON != undefined) {
                            ds = JSON.parse(string);
                        }
                        else {
                            ds = eval("(" + string + ")");
                        }

                        if (ds['error'] != null) {
                            alert(ds['error'][0].content);
                            return;
                        }

                        var data = null;
                        if ($('#IsPostBack').val() == "True") {
                            data = JSON.parse(xmlMyGrids[MyGrid_SN - 1]);
                        }
                        else {
                            data = ds['data'];
                        }
                        var deny = null;
                        if (ds['deny'] != null) {
                            deny = ds['deny'];
                        }
                        var files = null;
                        if (ds['files'] != null) {
                            files = ds['files'];
                        }
                        var others = null;
                        if (ds['others'] != null) {
                            others = ds['others'];
                        }
                        var options = {
                            grid: gridName,
                            canEdit: bEditabled,
                            canVisible: bVisiable,
                            source: ds['source'],
                            heads: ds['heads'],
                            data: data,
                            deny: deny,
                            files: files,
                            others: others,
                            headColor: "#F4A460",
                            pageSize: 10,
                            validate: MyGridValidates[MyGrid_SN - 1].validate,
                            itemload: MyGridItemLoads[MyGrid_SN - 1].itemload,
                            lang: 'tw'
                        };

                        $(".grid_" + rowid).DrawGrid(options);
                    }

                    t1 = setTimeout("DrawGrid()", 0);
                }
            });
        }

        //
        function LoadDataSourceItem() {

            if (DataSources == '') {

                var oSelector = $('#form1 [rel-params]');

                for (var idx2 = 0; idx2 <= oSelector.length - 1; idx2++) {
                    var target = '';

                    if ($(oSelector[idx2]).attr('id') != undefined)
                        target = '|' + $(oSelector[idx2]).attr('id') + '|';
                    else if ($(oSelector[idx2]).attr('control-id') != undefined)
                        target = '|' + $(oSelector[idx2]).attr('control-id') + '|';

                    var paramValue = $(oSelector[idx2]).attr('rel-params');
                    var aryParam = paramValue.replace(/\|\|/g, '\n').replace(/\|/g, '').split('\n');
                    for (var idx = 0; idx <= aryParam.length - 1; idx++) {
                        if (aryParam[idx] != '') {
                            var ary = aryParam[idx].split('=');

                            if ($('#' + ary[1].replace('fld.', '')).length == 0) {
                                $('#form1 [name=\"' + ary[1].replace('fld.', '') + '\"]').attr('rel-reload', target);
                            }
                            else {
                                if (($('#' + ary[1].replace('fld.', '') + '[rel-reload]')).length == 0) {
                                    $('#' + ary[1].replace('fld.', '')).attr('rel-reload', target);
                                }
                                else {
                                    var oldValue = $('#' + ary[1].replace('fld.', '')).attr('rel-reload');
                                    $('#' + ary[1].replace('fld.', '')).attr('rel-reload', oldValue + target);
                                }
                            }
                        }
                    }
                }

                oSelector = $('#form1 [rel-reload]');
                for (var idx = 0; idx <= oSelector.length - 1; idx++) {
                    var ary = $(oSelector[idx]).attr('rel-reload').replace(/\|\|/g, '\n').replace(/\|/g, '').split('\n');
                    for (var idx2 = 0; idx2 <= ary.length - 1; idx2++) {
                        if ($('#' + ary[idx2] + '[rel-reload]').length > 0) {

                            var object2 = $('#form1 [rel-reload*=\"|' + ary[idx2] + '|\"]');
                            for (var idx3 = 0; idx3 <= object2.length - 1; idx3++) {
                                var oldValue = $(object2[idx3]).attr('rel-reload');
                                $(object2[idx3]).attr('rel-reload', oldValue + $('#' + ary[idx2]).attr('rel-reload'));
                            }
                        }
                    }
                }

                //
                oSelector = $('#form1 [rel-reload]');
                for (var idx = 0; idx <= oSelector.length - 1; idx++) {

                    switch ($(oSelector[idx])[0].tagName.toUpperCase()) {
                        case 'INPUT':
                        case 'SELECT':
                            $(oSelector[idx]).change(function () {
                                if (!IsFormReady) return;

                                //
                                if ($('#strEdit').val().toUpperCase().indexOf(';' + $(this).attr('id').toUpperCase() + ';') == -1) return;

                                var ary = $(this).attr('rel-reload').replace(/\|\|/g, '\n').replace(/\|/g, '').split('\n');

                                for (var idx2 = 0; idx2 <= ary.length - 1; idx2++) {
                                    if ($('#' + ary[idx2]).length > 0) {
                                        switch ($('#' + ary[idx2])[0].tagName.toUpperCase()) {
                                            case 'SELECT':
                                                if ((',' + DataSources + ',').indexOf(',' + $('#' + ary[idx2]).attr('rel-source').replace('_', '') + ',') < 0) {
                                                    DataSources += (DataSources != '' ? ',' : '');
                                                    DataSources += $('#' + ary[idx2]).attr('rel-source').replace('_', '');
                                                }
                                                break;
                                            case 'DIV':
                                                if ($('#' + ary[idx2]).hasClass('customizeDialog')) {
                                                    var fields = $('#' + ary[idx2]).attr('rel-fields').replace(/\|\|/g, '\n').replace(/\|/g, '').split('\n');
                                                    for (var idx3 = 0; idx3 <= fields.length - 1; idx3++) {
                                                        switch ($('#' + fields[idx3].split('=')[1])[0].tagName.toUpperCase()) {
                                                            case 'INPUT':
                                                                $('#' + fields[idx3].split('=')[1]).val('');
                                                                break;
                                                            case 'TEXTAREA':
                                                                $('#' + fields[idx3].split('=')[1]).html('');
                                                                break;
                                                        }
                                                    }
                                                }
                                                break;
                                        }
                                    }
                                    else {
                                        if ($('#form1 [control-id=\"' + ary[idx2] + '\"').length > 0) {
                                            if ((',' + DataSources + ',').indexOf(',' + $('#form1 [control-id=\"' + ary[idx2] + '\"').attr('rel-source').replace('_', '') + ',') < 0) {
                                                DataSources += (DataSources != '' ? ',' : '');
                                                DataSources += $('#form1 [control-id=\"' + ary[idx2] + '\"').attr('rel-source').replace('_', '');
                                            }
                                        }
                                    }
                                }

                                if (DataSources != '') t2 = setTimeout("LoadDataSourceItem()", 0);
                            });
                            break;
                    }
                }
                return;
            }

            var colid = DataSources.split(',')[0];

            var paramFields = '';
            if ($('#_' + colid + ' [rel-params]').length > 0) {
                paramFields = $('#_' + colid + ' [rel-params]').attr('rel-params');
            }
            var paramValue = paramFields;
            if (paramFields != '') {
                var aryParam = paramFields.replace(/\|\|/g, '\n').replace(/\|/g, '').split('\n');
                for (var idx = 0; idx <= aryParam.length - 1; idx++) {
                    if (aryParam[idx] != '') {
                        var ary = aryParam[idx].split('=');

                        if ($('#' + ary[1].replace('fld.', '')).length == 0) {
                            var oSelector = $('#form1 [name=\"' + ary[1].replace('fld.', '') + '\"]');
                            for (var idx2 = 0; idx2 <= oSelector.length - 1; idx2++) {
                                if ($(oSelector[idx2]).is(':checked'))
                                    paramValue = paramValue.replace(ary[1], $(oSelector[idx2]).val());
                            }
                        }
                        else {
                            paramValue = paramValue.replace(ary[1], GetFieldValue(ary[1].replace('fld.', '')));
                        }
                    }
                }
            }

            var _random = Math.random();
            $.ajax({
                type: 'GET',
                url: '/FDService/getDataSourceItemData.aspx',                   //web service的URI
                data: 'logon=' + $('#logon').val() + '&guid=' + $('#FormGUID').val() + '&col=' + colid + '&caseid=' + $("#SPM_CaseId").val() + '&param=' + escape(paramValue) + '&random=' + _random,  //參數,JSON字串型態
                beforeSend: function () {
                    $.blockUI({ message: '<div style="font-size: 16px"><br /><img src="' + loadingImage + '" style="width: 26px" />&nbsp;' + LoadingMsg + '<br /><br /></div>' });
                },
                complete: function () {
                    $.unblockUI();
                },
                error: function (xhr, textStatus, errorThrown) {
                    $.unblockUI();
                    alert('An error occurred! ' + errorThrown);
                },
                success: function (responseData, textStatus, jqXHR) {
                    $.unblockUI();

                    if (DataSources == '') return;

                    DataSources = ('|' + DataSources.replace(/\,/g, '||') + '|').replace('|' + colid + '|', '');
                    DataSources = DataSources.replace(/\|\|/g, ',').replace(/\|/g, '');

                    var itemsClass = '';
                    if ($('#_' + colid).find('.radioItems').length > 0) {
                        itemsClass = 'radioItems';
                    }
                    if ($('#_' + colid).find('.checkboxItems').length > 0) {
                        itemsClass = 'checkboxItems';
                    }
                    if ($('#_' + colid).find('.optionItems').length > 0) {
                        itemsClass = 'optionItems';
                    }

                    $('#_' + colid).find('.' + itemsClass).html('');

                    if (responseData != "") {

                        switch (itemsClass) {
                            case 'optionItems':
                                option = $('<option></option>')
                                            .val('')
                                            .html('');
                                $('#_' + colid).find('.' + itemsClass).append(option);
                                break;
                        }

                        var label = null;
                        var input = null;
                        var option = null;

                        var item = responseData.replace(/\|\|/gi, '\n').replace(/\|/gi, '').split('\n');
                        for (var idx = 0; idx <= item.length - 1; idx++) {
                            param = item[idx].split('~');
                            switch (itemsClass) {
                                case 'radioItems':
                                    label = $('<label></label>');
                                    $('#_' + colid).find('.' + itemsClass).append(label);

                                    input = $('<input type=\"radio\" />')
                                            .val(param[3])
                                            .attr('name', $('#_' + colid).find('.' + itemsClass).attr('control-id'))
                                            .attr('id', $('#_' + colid).find('.' + itemsClass).attr('control-id') + '_' + param[3]);
                                    label.append(input);
                                    switch (lang) {
                                        case 'cn':
                                            label.append(param[1]);
                                            break;
                                        case 'en':
                                            label.append(param[2]);
                                            break;
                                        default:
                                            label.append(param[0]);
                                            break;
                                    }

                                    if (param[4] == 'true') input.prop('checked', true);
                                    if (param[5] != '') input.addClass(param[5]);
                                    break;

                                case 'checkboxItems':
                                    label = $('<label></label>').attr('style', 'display: inline-block;');
                                    $('#_' + colid).find('.' + itemsClass).append(label);

                                    input = $('<input type=\"checkbox\" />')
                                            .val(param[3])
                                            .attr('name', $('#_' + colid).find('.' + itemsClass).attr('control-id'))
                                            .attr('id', $('#_' + colid).find('.' + itemsClass).attr('control-id') + '_' + param[3]);
                                    label.append(input);
                                    switch (lang) {
                                        case 'cn':
                                            label.append(param[1]);
                                            break;
                                        case 'en':
                                            label.append(param[2]);
                                            break;
                                        default:
                                            label.append(param[0]);
                                            break;
                                    }

                                    if (param[4] == "true") input.prop('checked', true);
                                    if (param[5] != '') input.addClass(param[5]);
                                    break;

                                case 'optionItems':
                                    option = $('<option></option>')
                                            .val(param[3]);
                                    switch (lang) {
                                        case 'cn':
                                            option.html(param[1]);
                                            break;
                                        case 'en':
                                            option.html(param[2]);
                                            break;
                                        default:
                                            option.html(param[0]);
                                            break;
                                    }

                                    $('#_' + colid).find('.' + itemsClass).append(option);
                                    if (param[5] != '') $('#_' + colid).find('.' + itemsClass).addClass(param[5]);

                                    if (param[4] == 'true') option.prop('selected', true);
                                    break;
                            }
                        }
                    }
                    t2 = setTimeout("LoadDataSourceItem()", 0);
                }
            });
        }

        var XmlDom = null;

        $(function () {

            try {
                InitFormValidate();
            }
            catch (e) { }

            try {
                InitCallbackScripts();
            }
            catch (e) { }

            try {
                InitMyGridValidates();
            }
            catch (e) { }

            try {
                InitMyGridItemLoads();
            }
            catch (e) { }

            if ($("#SPM_Data").val() != "") {
                if (window.ActiveXObject) {
                    XmlDom = new ActiveXObject("Microsoft.XMLDOM");
                    XmlDom.async = false;
                }
                else if (document.implementation && document.implementation.createDocument) {
                    XmlDom = document.implementation.createDocument("", "", null);
                    XmlDom.async = false;

                    XMLDocument.prototype.selectSingleNode = Element.prototype.selectSingleNode = function (xpath) {
                        try {
                            if (window.XPathEvaluator) {
                                var xpe = new XPathEvaluator();
                                var nsResolver = xpe.createNSResolver(this.ownerDocument == null ? this.documentElement : this.ownerDocument.documentElement);

                                var result = xpe.evaluate(xpath, this, nsResolver, 0, null);
                                var found = [];
                                var res;
                                while (res = result.iterateNext()) {
                                    found.push(res);
                                }
                                if (found.length == 0) return null;
                                if (found.length > 0) return found[0];
                            }
                            else {
                                var node = this.documentElement.selectNodes(xpath);
                                return node;
                            }
                        }
                        catch (e) {
                            if (!bHavedShowError) {
                                alert(e.name + ": " + e.message);
                                bHavedShowError = true;
                            }
                            return null;
                        }
                    }

                    XMLDocument.prototype.selectNodes = Element.prototype.selectNodes = function (xpath) {
                        try {
                            var parser = new DOMParser();

                            try {
                                var doc = parser.parseFromString(xmlData, "text/xml");
                            }
                            catch (e) { return null; };

                            if (window.XPathEvaluator) {
                                var xpe = new XPathEvaluator();
                                var nsResolver = xpe.createNSResolver(doc.ownerDocument == null ? doc.documentElement : doc.ownerDocument.documentElement);

                                var result = xpe.evaluate(xpath, doc, nsResolver, 0, null);
                                var found = [];
                                var res;
                                while (res = result.iterateNext()) {
                                    found.push(res);
                                }

                                return found;
                            }
                            else {
                                var xpath_param;
                                xpath_param = xpath.split("/");
                                var node = this.getElementsByTagName(xpath_param[xpath_param.length - 1]);
                                if (node.length > 0) {
                                    return node[0];
                                }
                                else {
                                    return null;
                                }
                            }
                        }
                        catch (e) {
                            if (!bHavedShowError) {
                                alert(e.name + ": " + e.message);
                                bHavedShowError = true;
                            }
                            return null;
                        }
                    }
                }
                xmlData = document.getElementById("SPM_Data").value;
                xmlData = xmlData.replace(/\&lt;/gi, "<");
                xmlData = xmlData.replace(/\&gt;/gi, ">");
                xmlData = xmlData.replace(/\:/gi, "_a58a_");
                xmlData = xmlData.replace(/\SPM_a58a_/gi, "SPM:");
                xmlData = xmlData.replace(/\_a58a_SPM/gi, ":SPM");
                xmlData = xmlData.replace(/\&lt1;/gi, "%26lt1;");
                xmlData = xmlData.replace(/\&gt1;/gi, "%26gt1;");

                if (window.ActiveXObject) {
                    XmlDom.loadXML(xmlData);
                }
                else {
                    XmlDom = new DOMParser().parseFromString(xmlData, "text/xml");
                }
            }

            if ($('#IsPostBack').val() == "True") {
                var fdName = "";
                xmlMyGrids = MyGrids.split(',');
                for (var idx = 0; idx <= xmlMyGrids.length - 1; idx++) {
                    fdName = "__jsnMyGrid" + (idx + 1).toString();

                    nodeTmp = XmlDom.selectSingleNode("//EFormData/BPM_FieldData/" + fdName.replace(/\:/gi, "_a58a_").toUpperCase());

                    if (nodeTmp == null) {
                        nodeTmp = XmlDom.selectSingleNode("//EFormData/BPM_FieldData/" + fdName.replace(/\:/gi, "_a58a_"));
                    }
                    fdValue = GetNodeValue(nodeTmp);
                    fdValue = fdValue.replace(/\%3c/gi, "<");
                    fdValue = fdValue.replace(/\%3e/gi, ">");
                    fdValue = fdValue.replace(/\%26amp;/gi, "&");
                    fdValue = fdValue.replace(/\%26/gi, "&");
                    fdValue = fdValue.replace(/\&lt1;/gi, "<");
                    fdValue = fdValue.replace(/\&gt1;/gi, ">");
                    fdValue = fdValue.replace(/\_a58a_/gi, ":");
                    xmlMyGrids[idx] = fdValue;
                }
            }

            t1 = setTimeout("DrawGrid()", 0);

            t2 = setTimeout("LoadDataSourceItem()", 0);
        });

        var GetNodeValue = function (obj) {
            var str = "";
            if (window.ActiveXObject)    //IE
            {
                str = obj.text;
            }
            else //Mozilla
            {
                try {
                    str = obj.childNodes[0].nodeValue;
                }
                catch (ex) {
                    str = "";
                }
            }
            return str;
        };

        function GetFieldValue(fdName) {
            var ret = '';
            if (!IsFormReady) {
                var nodeTmp = XmlDom.selectSingleNode("//EFormData/BPM_FieldData/" + fdName.replace(/\:/gi, "_a58a_").toUpperCase());

                if (nodeTmp == null) {
                    nodeTmp = XmlDom.selectSingleNode("//EFormData/BPM_FieldData/" + fdName.replace(/\:/gi, "_a58a_"));
                }
                if (nodeTmp != null) {
                    ret = GetNodeValue(nodeTmp);
                }
                else
                {
                    var oSelector = $('#form1 [id=\"' + fdName + '\"]');
                    switch ($(oSelector)[0].tagName.toUpperCase()) {
                        case 'INPUT':
                        case 'SELECT':
                            ret = $(oSelector).val();
                            break;
                    }
                }
            }
            else {
                var oSelector = $('#form1 [id=\"' + fdName + '\"]');
                switch ($(oSelector)[0].tagName.toUpperCase()) {
                    case 'INPUT':
                    case 'SELECT':
                        ret = $(oSelector).val();
                        break;
                }
            }
            return ret;
        }

    </script>

</body>
</html>
